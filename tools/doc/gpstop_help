COMMAND NAME: gpstop

Stops or restarts a HAWQ system.


*****************************************************
SYNOPSIS
*****************************************************

gpstop [-d <master_data_directory>] [-B <parallel_processes>] 
       [-M smart | fast | immediate] [-t <timeout_seconds>]
       [-r] [-y] [-a] [-l <logfile_directory>] [-v | -q]

gpstop -m [-d <master_data_directory>] [-y] [-l <logfile_directory>] 
       [-v | -q]

gpstop -u [-d <master_data_directory>] [-l <logfile_directory>] 
          [-v | -q] 

gpstop --version

gpstop -? | -h | --help


*****************************************************
DESCRIPTION
*****************************************************

The gpstop utility is used to stop the database servers that 
comprise a HAWQ system. When you stop a HAWQ system, you 
are actually stopping several postgres database server 
processes at once (the master and all of the segment instances).
The gpstop utility handles the shutdown of the individual 
instances. Each instance is shutdown in parallel. 

By default, you are not allowed to shut down HAWQ if there 
are any client connections to the database. Use the -M fast 
option to roll back all in progress transactions and terminate 
any connections before shutting down. If there are any 
transactions in progress, the default behavior is to wait 
for them to commit before shutting down.

With the -u option, the utility uploads changes made to the 
master pg_hba.conf file or to runtime configuration parameters 
in the master postgresql.conf file without interruption of 
service. Note that any active sessions will not pickup the 
changes until they reconnect to the database.

*****************************************************
OPTIONS
*****************************************************

-a (do not prompt)

 Do not prompt the user for confirmation.


-B <parallel_processes>

 The number of segments to stop in parallel. If not specified, 
 the utility will start up to 60 parallel processes depending 
 on how many segment instances it needs to stop.


-d <master_data_directory>

 Optional. The master host data directory. If not specified, 
 the value set for $MASTER_DATA_DIRECTORY will be used.


-l <logfile_directory>

 The directory to write the log file. Defaults to ~/gpAdminLogs.


-m (master only)

 Optional. Shuts down a HAWQ master instance that was 
 started in maintenance mode.


-M fast (fast shutdown - rollback)

 Fast shut down. Any transactions in progress are interrupted 
 and rolled back. 


-M immediate (immediate shutdown - abort)

 Immediate shut down. Any transactions in progress are aborted. 
 This shutdown mode is not recommended. This mode kills all postgres 
 processes without allowing the database server to complete transaction 
 processing or clean up any temporary or in-process work files. 
 

-M smart (smart shutdown - warn)
 
 Smart shut down. If there are active connections, this command 
 fails with a warning. This is the default shutdown mode.


-q (no screen output)

 Run in quiet mode. Command output is not displayed on the 
 screen, but is still written to the log file.


-r (restart)

 Restart after shutdown is complete.

-t <timeout_seconds>

 Specifies a timeout threshold (in seconds) to wait for a 
 segment instance to shutdown. If a segment instance does not 
 shutdown in the specified number of seconds, gpstop displays 
 a message indicating that one or more segments are still in 
 the process of shutting down and that you cannot restart 
 HAWQ until the segment instance(s) are stopped. 
 This option is useful in situations where gpstop is executed 
 and there are very large transactions that need to rollback. 
 These large transactions can take over a minute to rollback 
 and surpass the default timeout period of 600 seconds.


-u (reload pg_hba.conf and postgresql.conf files only)

 This option reloads the pg_hba.conf files of the master and 
 segments and the runtime parameters of the postgresql.conf files 
 but does not shutdown the HAWQ array. Use this 
 option to make new configuration settings active after editing 
 postgresql.conf or pg_hba.conf. Note that this only applies to 
 configuration parameters that are designated as runtime 
 parameters. In HAWQ if there are some failed segments, 
 this option can not be executed.


-v (verbose output)

 Displays detailed status, progress and error messages output 
 by the utility.


--version (show utility version)

 Displays the version of this utility.


-y (do not stop standby master)

 Do not stop the standby master process. The default is to stop 
 the standby master.


-? | -h | --help (help)

 Displays the online help.


*****************************************************
EXAMPLES
*****************************************************

Stop a HAWQ system in smart mode:

  gpstop

Stop a HAWQ system in fast mode:

  gpstop -M fast


Stop all segment instances and then restart the system:

  gpstop -r


Stop a master instance that was started in maintenance mode:

  gpstop -m


Reload the postgresql.conf and pg_hba.conf files after 
making runtime configuration parameter changes but do not 
shutdown the HAWQ array:

  gpstop -u


