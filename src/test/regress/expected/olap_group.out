--
-- OLAP_GROUP - Test OLAP GROUP BY extensions
--
-- Syntactic equivalents --
--start_equiv
select count(*) from sale;
 count 
-------
    12
(1 row)

select count(*) from sale group by ();
 count 
-------
    12
(1 row)

--end_equiv
--start_equiv
select cn, count(*) from sale group by cn;
 cn | count 
----+-------
  3 |     3
  1 |     5
  4 |     2
  2 |     2
(4 rows)

select cn, count(*) from sale group by (), cn;
 cn | count 
----+-------
  3 |     3
  1 |     5
  4 |     2
  2 |     2
(4 rows)

select cn, count(*) from sale group by cn, ();
 cn | count 
----+-------
  1 |     5
  2 |     2
  3 |     3
  4 |     2
(4 rows)

--end_equiv
--start_equiv
select cn, vn, count(*) from sale group by cn, vn;
 cn | vn | count 
----+----+-------
  1 | 10 |     1
  1 | 20 |     1
  3 | 30 |     2
  1 | 30 |     2
  3 | 40 |     1
  1 | 50 |     1
  4 | 40 |     2
  2 | 40 |     1
  2 | 50 |     1
(9 rows)

select cn, vn, count(*) from sale group by (), cn, vn;
 cn | vn | count 
----+----+-------
  1 | 10 |     1
  1 | 20 |     1
  1 | 30 |     2
  1 | 50 |     1
  2 | 40 |     1
  2 | 50 |     1
  3 | 30 |     2
  3 | 40 |     1
  4 | 40 |     2
(9 rows)

select cn, vn, count(*) from sale group by cn, (), vn;
 cn | vn | count 
----+----+-------
  1 | 10 |     1
  1 | 20 |     1
  3 | 30 |     2
  1 | 30 |     2
  3 | 40 |     1
  1 | 50 |     1
  4 | 40 |     2
  2 | 40 |     1
  2 | 50 |     1
(9 rows)

select cn, vn, count(*) from sale group by cn, vn, ();
 cn | vn | count 
----+----+-------
  1 | 10 |     1
  1 | 20 |     1
  3 | 30 |     2
  1 | 30 |     2
  3 | 40 |     1
  1 | 50 |     1
  4 | 40 |     2
  2 | 40 |     1
  2 | 50 |     1
(9 rows)

select cn, vn, count(*) from sale group by (), cn, (), vn, ();
 cn | vn | count 
----+----+-------
  1 | 10 |     1
  1 | 20 |     1
  3 | 30 |     2
  1 | 30 |     2
  3 | 40 |     1
  1 | 50 |     1
  4 | 40 |     2
  2 | 40 |     1
  2 | 50 |     1
(9 rows)

--end_equiv
-- Semantic equivalents --
--start_equiv
select cn, vn, pn, sum(qty*prc) from sale group by cn, vn, pn
union all
select cn, vn, null, sum(qty*prc) from sale group by cn, vn
union all
select cn, null, null, sum(qty*prc) from sale group by cn
union all
select null, null, null, sum(qty*prc) from sale;    
 cn | vn | pn  |   sum   
----+----+-----+---------
  4 | 40 | 800 |       1
  3 | 30 | 600 |      60
  2 | 50 | 400 |       0
  1 | 10 | 200 |       0
  3 | 40 | 200 |       0
  1 | 20 | 100 |       0
  1 | 10 |     |       0
  1 | 20 |     |       0
  3 | 30 |     |     120
  1 | 30 |     |      60
  3 | 40 |     |       0
  1 | 50 |     |       0
  3 |    |     |     120
  1 |    |     |      60
    |    |     | 2640182
  4 | 40 | 700 |       1
  1 | 50 | 400 |       0
  1 | 30 | 500 |      60
  3 | 30 | 500 |      60
  1 | 30 | 300 |       0
  2 | 40 | 100 | 2640000
  4 | 40 |     |       2
  2 | 40 |     | 2640000
  2 | 50 |     |       0
  4 |    |     |       2
  2 |    |     | 2640000
(26 rows)

select cn, vn, pn, sum(qty*prc) from sale group by rollup(cn,vn,pn);
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 10 | 200 |       0
  1 | 10 |     |       0
  1 | 20 | 100 |       0
  1 | 20 |     |       0
  1 | 30 | 300 |       0
  1 | 30 | 500 |      60
  1 | 30 |     |      60
  1 | 50 | 400 |       0
  1 | 50 |     |       0
  1 |    |     |      60
  2 | 40 | 100 | 2640000
  2 | 40 |     | 2640000
  2 | 50 | 400 |       0
  2 | 50 |     |       0
  2 |    |     | 2640000
  3 | 30 | 500 |      60
  3 | 30 | 600 |      60
  3 | 30 |     |     120
  3 | 40 | 200 |       0
  3 | 40 |     |       0
  3 |    |     |     120
  4 | 40 | 700 |       1
  4 | 40 | 800 |       1
  4 | 40 |     |       2
  4 |    |     |       2
    |    |     | 2640182
(26 rows)

select cn, vn, pn, sum(qty*prc) from sale group by grouping sets((), (cn), (cn,vn), (cn,vn,pn));
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 10 | 200 |       0
  1 | 10 |     |       0
  1 | 20 | 100 |       0
  1 | 20 |     |       0
  1 | 30 | 300 |       0
  1 | 30 | 500 |      60
  1 | 30 |     |      60
  1 | 50 | 400 |       0
  1 | 50 |     |       0
  1 |    |     |      60
  2 | 40 | 100 | 2640000
  2 | 40 |     | 2640000
  2 | 50 | 400 |       0
  2 | 50 |     |       0
  2 |    |     | 2640000
  3 | 30 | 500 |      60
  3 | 30 | 600 |      60
  3 | 30 |     |     120
  3 | 40 | 200 |       0
  3 | 40 |     |       0
  3 |    |     |     120
  4 | 40 | 700 |       1
  4 | 40 | 800 |       1
  4 | 40 |     |       2
  4 |    |     |       2
    |    |     | 2640182
(26 rows)

select cn, vn, pn, sum(qty*prc) from sale group by grouping sets((cn,vn), (), (cn,vn,pn), (cn));
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 10 | 200 |       0
  1 | 10 |     |       0
  1 | 20 | 100 |       0
  1 | 20 |     |       0
  1 | 30 | 300 |       0
  1 | 30 | 500 |      60
  1 | 30 |     |      60
  1 | 50 | 400 |       0
  1 | 50 |     |       0
  1 |    |     |      60
  2 | 40 | 100 | 2640000
  2 | 40 |     | 2640000
  2 | 50 | 400 |       0
  2 | 50 |     |       0
  2 |    |     | 2640000
  3 | 30 | 500 |      60
  3 | 30 | 600 |      60
  3 | 30 |     |     120
  3 | 40 | 200 |       0
  3 | 40 |     |       0
  3 |    |     |     120
  4 | 40 | 700 |       1
  4 | 40 | 800 |       1
  4 | 40 |     |       2
  4 |    |     |       2
    |    |     | 2640182
(26 rows)

--end_equiv
--start_equiv
select cn, vn, pn, sum(qty*prc) from sale group by cn, vn, pn
union all
select cn, vn, null, sum(qty*prc) from sale group by cn, vn
union all
select cn, null, null, sum(qty*prc) from sale group by cn
union all
select null, null, null, sum(qty*prc) from sale
union all
select cn, null, pn, sum(qty*prc) from sale group by cn, pn
union all
select null, vn, pn, sum(qty*prc) from sale group by vn, pn
union all
select null, vn, null, sum(qty*prc) from sale group by vn
union all
select null, null, pn, sum(qty*prc) from sale group by pn;
 cn | vn | pn  |   sum   
----+----+-----+---------
  4 | 40 | 800 |       1
  3 | 30 | 600 |      60
  2 | 50 | 400 |       0
  1 | 10 | 200 |       0
  3 | 40 | 200 |       0
  1 | 20 | 100 |       0
  1 | 10 |     |       0
  1 | 20 |     |       0
  3 | 30 |     |     120
  1 | 30 |     |      60
  3 | 40 |     |       0
  1 | 50 |     |       0
  3 |    |     |     120
  1 |    |     |      60
    |    |     | 2640182
  1 |    | 100 |       0
  1 |    | 200 |       0
  3 |    | 200 |       0
  2 |    | 400 |       0
  3 |    | 600 |      60
  4 |    | 800 |       1
    | 30 | 300 |       0
    | 30 | 500 |     120
    | 50 | 400 |       0
    | 40 | 800 |       1
    |    | 800 |       1
    |    | 500 |     120
    |    | 400 |       0
    |    | 300 |       0
  4 | 40 | 700 |       1
  1 | 50 | 400 |       0
  1 | 30 | 500 |      60
  3 | 30 | 500 |      60
  1 | 30 | 300 |       0
  2 | 40 | 100 | 2640000
  4 | 40 |     |       2
  2 | 40 |     | 2640000
  2 | 50 |     |       0
  4 |    |     |       2
  2 |    |     | 2640000
  2 |    | 100 | 2640000
  1 |    | 300 |       0
  1 |    | 400 |       0
  3 |    | 500 |      60
  1 |    | 500 |      60
  4 |    | 700 |       1
    | 40 | 100 | 2640000
    | 20 | 100 |       0
    | 40 | 200 |       0
    | 10 | 200 |       0
    | 30 | 600 |      60
    | 40 | 700 |       1
    | 50 |     |       0
    | 40 |     | 2640002
    | 30 |     |     180
    | 20 |     |       0
    | 10 |     |       0
    |    | 700 |       1
    |    | 600 |      60
    |    | 200 |       0
    |    | 100 | 2640000
(61 rows)

select cn, vn, pn, sum(qty*prc) from sale group by cube (cn, vn, pn);
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 20 | 100 |       0
    | 20 | 100 |       0
  2 | 40 | 100 | 2640000
    | 40 | 100 | 2640000
    |    | 100 | 2640000
  1 | 10 | 200 |       0
    | 10 | 200 |       0
  3 | 40 | 200 |       0
    | 40 | 200 |       0
    |    | 200 |       0
  1 | 30 | 300 |       0
    | 30 | 300 |       0
    |    | 300 |       0
  1 | 50 | 400 |       0
  2 | 50 | 400 |       0
    | 50 | 400 |       0
    |    | 400 |       0
  1 | 30 | 500 |      60
  3 | 30 | 500 |      60
    | 30 | 500 |     120
    |    | 500 |     120
  3 | 30 | 600 |      60
    | 30 | 600 |      60
    |    | 600 |      60
  4 | 40 | 700 |       1
    | 40 | 700 |       1
    |    | 700 |       1
  4 | 40 | 800 |       1
    | 40 | 800 |       1
    |    | 800 |       1
    |    |     | 2640182
  1 |    | 100 |       0
  1 |    | 200 |       0
  1 |    | 300 |       0
  1 |    | 400 |       0
  1 |    | 500 |      60
  1 |    |     |      60
  2 |    | 100 | 2640000
  2 |    | 400 |       0
  2 |    |     | 2640000
  3 |    | 200 |       0
  3 |    | 500 |      60
  3 |    | 600 |      60
  3 |    |     |     120
  4 |    | 700 |       1
  4 |    | 800 |       1
  4 |    |     |       2
  1 | 10 |     |       0
    | 10 |     |       0
  1 | 20 |     |       0
    | 20 |     |       0
  1 | 30 |     |      60
  3 | 30 |     |     120
    | 30 |     |     180
  2 | 40 |     | 2640000
  3 | 40 |     |       0
  4 | 40 |     |       2
    | 40 |     | 2640002
  1 | 50 |     |       0
  2 | 50 |     |       0
    | 50 |     |       0
(61 rows)

select cn, vn, pn, sum(qty*prc) from sale group by grouping sets ((), (cn), (vn), (pn), (cn,vn), (cn,pn), (vn,pn), (cn,vn,pn));
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 20 | 100 |       0
    | 20 | 100 |       0
  2 | 40 | 100 | 2640000
    | 40 | 100 | 2640000
    |    | 100 | 2640000
  1 | 10 | 200 |       0
    | 10 | 200 |       0
  3 | 40 | 200 |       0
    | 40 | 200 |       0
    |    | 200 |       0
  1 | 30 | 300 |       0
    | 30 | 300 |       0
    |    | 300 |       0
  1 | 50 | 400 |       0
  2 | 50 | 400 |       0
    | 50 | 400 |       0
    |    | 400 |       0
  1 | 30 | 500 |      60
  3 | 30 | 500 |      60
    | 30 | 500 |     120
    |    | 500 |     120
  3 | 30 | 600 |      60
    | 30 | 600 |      60
    |    | 600 |      60
  4 | 40 | 700 |       1
    | 40 | 700 |       1
    |    | 700 |       1
  4 | 40 | 800 |       1
    | 40 | 800 |       1
    |    | 800 |       1
    |    |     | 2640182
  1 |    | 100 |       0
  1 |    | 200 |       0
  1 |    | 300 |       0
  1 |    | 400 |       0
  1 |    | 500 |      60
  1 |    |     |      60
  2 |    | 100 | 2640000
  2 |    | 400 |       0
  2 |    |     | 2640000
  3 |    | 200 |       0
  3 |    | 500 |      60
  3 |    | 600 |      60
  3 |    |     |     120
  4 |    | 700 |       1
  4 |    | 800 |       1
  4 |    |     |       2
  1 | 10 |     |       0
    | 10 |     |       0
  1 | 20 |     |       0
    | 20 |     |       0
  1 | 30 |     |      60
  3 | 30 |     |     120
    | 30 |     |     180
  2 | 40 |     | 2640000
  3 | 40 |     |       0
  4 | 40 |     |       2
    | 40 |     | 2640002
  1 | 50 |     |       0
  2 | 50 |     |       0
    | 50 |     |       0
(61 rows)

--end_equiv
--start_equiv
select cn, vn, pn, count(distinct dt) from sale group by cn, vn, pn
union all
select cn, vn, null, count(distinct dt) from sale group by cn, vn
union all
select cn, null, null, count(distinct dt) from sale group by cn
union all
select null, null, null, count(distinct dt) from sale;    --mvd 1,2,3->4
 cn | vn | pn  | count 
----+----+-----+-------
    |    |     |     6
  1 |    |     |     4
  1 | 10 |     |     1
  1 | 10 | 200 |     1
  1 | 20 |     |     1
  1 | 20 | 100 |     1
  1 | 30 |     |     2
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 50 |     |     1
  1 | 50 | 400 |     1
  2 |    |     |     2
  2 | 40 |     |     1
  2 | 40 | 100 |     1
  2 | 50 |     |     1
  2 | 50 | 400 |     1
  3 |    |     |     2
  3 | 30 |     |     1
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 40 |     |     1
  3 | 40 | 200 |     1
  4 |    |     |     1
  4 | 40 |     |     1
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
(26 rows)

select cn, vn, pn, count(distinct dt) from sale group by rollup(cn,vn,pn);--mvd 1,2,3->4
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 20 | 100 |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 50 | 400 |     1
  2 | 40 | 100 |     1
  2 | 50 | 400 |     1
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 40 | 200 |     1
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  1 | 10 |     |     1
  1 | 20 |     |     1
  1 | 30 |     |     2
  1 | 50 |     |     1
  2 | 40 |     |     1
  2 | 50 |     |     1
  3 | 30 |     |     1
  3 | 40 |     |     1
  4 | 40 |     |     1
  1 |    |     |     4
  2 |    |     |     2
  3 |    |     |     2
  4 |    |     |     1
    |    |     |     6
(26 rows)

select cn, vn, pn, count(distinct dt) from sale group by grouping sets((), (cn), (cn,vn), (cn,vn,pn));--mvd 1,2,3->4
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 20 | 100 |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 50 | 400 |     1
  2 | 40 | 100 |     1
  2 | 50 | 400 |     1
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 40 | 200 |     1
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  1 | 10 |     |     1
  1 | 20 |     |     1
  1 | 30 |     |     2
  1 | 50 |     |     1
  2 | 40 |     |     1
  2 | 50 |     |     1
  3 | 30 |     |     1
  3 | 40 |     |     1
  4 | 40 |     |     1
  1 |    |     |     4
  2 |    |     |     2
  3 |    |     |     2
  4 |    |     |     1
    |    |     |     6
(26 rows)

--end_equiv
--start_equiv order 1,2,3
select cn, vn, pn, count(distinct dt) from sale group by cn, vn, pn
union all
select cn, vn, null, count(distinct dt) from sale group by cn, vn
union all
select cn, null, null, count(distinct dt) from sale group by cn
union all
select null, null, null, count(distinct dt) from sale
union all
select cn, null, pn, count(distinct dt) from sale group by cn, pn
union all
select null, vn, pn, count(distinct dt) from sale group by vn, pn
union all
select null, vn, null, count(distinct dt) from sale group by vn
union all
select null, null, pn, count(distinct dt) from sale group by pn
order by 1,2,3; -- order 1,2,3
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 10 |     |     1
  1 | 20 | 100 |     1
  1 | 20 |     |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 30 |     |     2
  1 | 50 | 400 |     1
  1 | 50 |     |     1
  1 |    | 100 |     1
  1 |    | 200 |     1
  1 |    | 300 |     1
  1 |    | 400 |     1
  1 |    | 500 |     1
  1 |    |     |     4
  2 | 40 | 100 |     1
  2 | 40 |     |     1
  2 | 50 | 400 |     1
  2 | 50 |     |     1
  2 |    | 100 |     1
  2 |    | 400 |     1
  2 |    |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 30 |     |     1
  3 | 40 | 200 |     1
  3 | 40 |     |     1
  3 |    | 200 |     1
  3 |    | 500 |     1
  3 |    | 600 |     1
  3 |    |     |     2
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  4 | 40 |     |     1
  4 |    | 700 |     1
  4 |    | 800 |     1
  4 |    |     |     1
    | 10 | 200 |     1
    | 10 |     |     1
    | 20 | 100 |     1
    | 20 |     |     1
    | 30 | 300 |     1
    | 30 | 500 |     1
    | 30 | 600 |     1
    | 30 |     |     2
    | 40 | 100 |     1
    | 40 | 200 |     1
    | 40 | 700 |     1
    | 40 | 800 |     1
    | 40 |     |     3
    | 50 | 400 |     1
    | 50 |     |     1
    |    | 100 |     2
    |    | 200 |     2
    |    | 300 |     1
    |    | 400 |     1
    |    | 500 |     1
    |    | 600 |     1
    |    | 700 |     1
    |    | 800 |     1
    |    |     |     6
(61 rows)

select cn, vn, pn, count(distinct dt) from sale group by cube (cn, vn, pn) order by 1,2,3; -- order 1,2,3
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 10 |     |     1
  1 | 20 | 100 |     1
  1 | 20 |     |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 30 |     |     2
  1 | 50 | 400 |     1
  1 | 50 |     |     1
  1 |    | 100 |     1
  1 |    | 200 |     1
  1 |    | 300 |     1
  1 |    | 400 |     1
  1 |    | 500 |     1
  1 |    |     |     4
  2 | 40 | 100 |     1
  2 | 40 |     |     1
  2 | 50 | 400 |     1
  2 | 50 |     |     1
  2 |    | 100 |     1
  2 |    | 400 |     1
  2 |    |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 30 |     |     1
  3 | 40 | 200 |     1
  3 | 40 |     |     1
  3 |    | 200 |     1
  3 |    | 500 |     1
  3 |    | 600 |     1
  3 |    |     |     2
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  4 | 40 |     |     1
  4 |    | 700 |     1
  4 |    | 800 |     1
  4 |    |     |     1
    | 10 | 200 |     1
    | 10 |     |     1
    | 20 | 100 |     1
    | 20 |     |     1
    | 30 | 300 |     1
    | 30 | 500 |     1
    | 30 | 600 |     1
    | 30 |     |     2
    | 40 | 100 |     1
    | 40 | 200 |     1
    | 40 | 700 |     1
    | 40 | 800 |     1
    | 40 |     |     3
    | 50 | 400 |     1
    | 50 |     |     1
    |    | 100 |     2
    |    | 200 |     2
    |    | 300 |     1
    |    | 400 |     1
    |    | 500 |     1
    |    | 600 |     1
    |    | 700 |     1
    |    | 800 |     1
    |    |     |     6
(61 rows)

select cn, vn, pn, count(distinct dt) from sale group by grouping sets ((), (cn), (vn), (pn), (cn,vn), (cn,pn), (vn,pn), (cn,vn,pn)) order by 1,2,3; -- order 1,2,3
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 10 |     |     1
  1 | 20 | 100 |     1
  1 | 20 |     |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 30 |     |     2
  1 | 50 | 400 |     1
  1 | 50 |     |     1
  1 |    | 100 |     1
  1 |    | 200 |     1
  1 |    | 300 |     1
  1 |    | 400 |     1
  1 |    | 500 |     1
  1 |    |     |     4
  2 | 40 | 100 |     1
  2 | 40 |     |     1
  2 | 50 | 400 |     1
  2 | 50 |     |     1
  2 |    | 100 |     1
  2 |    | 400 |     1
  2 |    |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 30 |     |     1
  3 | 40 | 200 |     1
  3 | 40 |     |     1
  3 |    | 200 |     1
  3 |    | 500 |     1
  3 |    | 600 |     1
  3 |    |     |     2
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  4 | 40 |     |     1
  4 |    | 700 |     1
  4 |    | 800 |     1
  4 |    |     |     1
    | 10 | 200 |     1
    | 10 |     |     1
    | 20 | 100 |     1
    | 20 |     |     1
    | 30 | 300 |     1
    | 30 | 500 |     1
    | 30 | 600 |     1
    | 30 |     |     2
    | 40 | 100 |     1
    | 40 | 200 |     1
    | 40 | 700 |     1
    | 40 | 800 |     1
    | 40 |     |     3
    | 50 | 400 |     1
    | 50 |     |     1
    |    | 100 |     2
    |    | 200 |     2
    |    | 300 |     1
    |    | 400 |     1
    |    | 500 |     1
    |    | 600 |     1
    |    | 700 |     1
    |    | 800 |     1
    |    |     |     6
(61 rows)

--end_equiv
--start_equiv order 1,2,3
select cn, vn, pn, sum(qty*prc) from sale group by cn, vn, pn
union all
select cn, vn, null, sum(qty*prc) from sale group by cn, vn
union all
select cn, null, null, sum(qty*prc) from sale group by cn
union all
select null, null, null, sum(qty*prc) from sale 
order by 1,2,3; -- order 1,2,3
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 10 | 200 |       0
  1 | 10 |     |       0
  1 | 20 | 100 |       0
  1 | 20 |     |       0
  1 | 30 | 300 |       0
  1 | 30 | 500 |      60
  1 | 30 |     |      60
  1 | 50 | 400 |       0
  1 | 50 |     |       0
  1 |    |     |      60
  2 | 40 | 100 | 2640000
  2 | 40 |     | 2640000
  2 | 50 | 400 |       0
  2 | 50 |     |       0
  2 |    |     | 2640000
  3 | 30 | 500 |      60
  3 | 30 | 600 |      60
  3 | 30 |     |     120
  3 | 40 | 200 |       0
  3 | 40 |     |       0
  3 |    |     |     120
  4 | 40 | 700 |       1
  4 | 40 | 800 |       1
  4 | 40 |     |       2
  4 |    |     |       2
    |    |     | 2640182
(26 rows)

select cn, vn, pn, sum(qty*prc) from sale group by rollup(cn,vn,pn) order by 1,2,3; -- order 1,2,3
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 10 | 200 |       0
  1 | 10 |     |       0
  1 | 20 | 100 |       0
  1 | 20 |     |       0
  1 | 30 | 300 |       0
  1 | 30 | 500 |      60
  1 | 30 |     |      60
  1 | 50 | 400 |       0
  1 | 50 |     |       0
  1 |    |     |      60
  2 | 40 | 100 | 2640000
  2 | 40 |     | 2640000
  2 | 50 | 400 |       0
  2 | 50 |     |       0
  2 |    |     | 2640000
  3 | 30 | 500 |      60
  3 | 30 | 600 |      60
  3 | 30 |     |     120
  3 | 40 | 200 |       0
  3 | 40 |     |       0
  3 |    |     |     120
  4 | 40 | 700 |       1
  4 | 40 | 800 |       1
  4 | 40 |     |       2
  4 |    |     |       2
    |    |     | 2640182
(26 rows)

select cn, vn, pn, sum(qty*prc) from sale group by grouping sets((), (cn), (cn,vn), (cn,vn,pn)) order by 1,2,3; -- order 1,2,3
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 10 | 200 |       0
  1 | 10 |     |       0
  1 | 20 | 100 |       0
  1 | 20 |     |       0
  1 | 30 | 300 |       0
  1 | 30 | 500 |      60
  1 | 30 |     |      60
  1 | 50 | 400 |       0
  1 | 50 |     |       0
  1 |    |     |      60
  2 | 40 | 100 | 2640000
  2 | 40 |     | 2640000
  2 | 50 | 400 |       0
  2 | 50 |     |       0
  2 |    |     | 2640000
  3 | 30 | 500 |      60
  3 | 30 | 600 |      60
  3 | 30 |     |     120
  3 | 40 | 200 |       0
  3 | 40 |     |       0
  3 |    |     |     120
  4 | 40 | 700 |       1
  4 | 40 | 800 |       1
  4 | 40 |     |       2
  4 |    |     |       2
    |    |     | 2640182
(26 rows)

--end_equiv
--start_equiv order 3,4,1
select pn, sum(qty*prc), cn, vn from sale group by cn, vn, pn
union all
select null, sum(qty*prc), cn, vn from sale group by cn, vn
union all
select null, sum(qty*prc), cn, null from sale group by cn
union all
select null, sum(qty*prc), null, null from sale 
order by cn, vn, pn; -- order 3,4,1
 pn  |   sum   | cn | vn 
-----+---------+----+----
 200 |       0 |  1 | 10
     |       0 |  1 | 10
 100 |       0 |  1 | 20
     |       0 |  1 | 20
 300 |       0 |  1 | 30
 500 |      60 |  1 | 30
     |      60 |  1 | 30
 400 |       0 |  1 | 50
     |       0 |  1 | 50
     |      60 |  1 |   
 100 | 2640000 |  2 | 40
     | 2640000 |  2 | 40
 400 |       0 |  2 | 50
     |       0 |  2 | 50
     | 2640000 |  2 |   
 500 |      60 |  3 | 30
 600 |      60 |  3 | 30
     |     120 |  3 | 30
 200 |       0 |  3 | 40
     |       0 |  3 | 40
     |     120 |  3 |   
 700 |       1 |  4 | 40
 800 |       1 |  4 | 40
     |       2 |  4 | 40
     |       2 |  4 |   
     | 2640182 |    |   
(26 rows)

select pn, sum(qty*prc), cn, vn from sale group by rollup(cn,vn,pn) order by cn, vn, pn; -- order 3,4,1
 pn  |   sum   | cn | vn 
-----+---------+----+----
 200 |       0 |  1 | 10
     |       0 |  1 | 10
 100 |       0 |  1 | 20
     |       0 |  1 | 20
 300 |       0 |  1 | 30
 500 |      60 |  1 | 30
     |      60 |  1 | 30
 400 |       0 |  1 | 50
     |       0 |  1 | 50
     |      60 |  1 |   
 100 | 2640000 |  2 | 40
     | 2640000 |  2 | 40
 400 |       0 |  2 | 50
     |       0 |  2 | 50
     | 2640000 |  2 |   
 500 |      60 |  3 | 30
 600 |      60 |  3 | 30
     |     120 |  3 | 30
 200 |       0 |  3 | 40
     |       0 |  3 | 40
     |     120 |  3 |   
 700 |       1 |  4 | 40
 800 |       1 |  4 | 40
     |       2 |  4 | 40
     |       2 |  4 |   
     | 2640182 |    |   
(26 rows)

select pn, sum(qty*prc), cn, vn from sale group by grouping sets((), (cn), (cn,vn), (cn,vn,pn)) order by cn, vn, pn; -- order 3,4,1
 pn  |   sum   | cn | vn 
-----+---------+----+----
 200 |       0 |  1 | 10
     |       0 |  1 | 10
 100 |       0 |  1 | 20
     |       0 |  1 | 20
 300 |       0 |  1 | 30
 500 |      60 |  1 | 30
     |      60 |  1 | 30
 400 |       0 |  1 | 50
     |       0 |  1 | 50
     |      60 |  1 |   
 100 | 2640000 |  2 | 40
     | 2640000 |  2 | 40
 400 |       0 |  2 | 50
     |       0 |  2 | 50
     | 2640000 |  2 |   
 500 |      60 |  3 | 30
 600 |      60 |  3 | 30
     |     120 |  3 | 30
 200 |       0 |  3 | 40
     |       0 |  3 | 40
     |     120 |  3 |   
 700 |       1 |  4 | 40
 800 |       1 |  4 | 40
     |       2 |  4 | 40
     |       2 |  4 |   
     | 2640182 |    |   
(26 rows)

--end_equiv
--start_equiv order 1,2,3
select cn, vn, pn, sum(qty*prc) from sale group by cn, vn, pn
union all
select cn, vn, null, sum(qty*prc) from sale group by cn, vn
union all
select cn, null, null, sum(qty*prc) from sale group by cn
union all
select null, null, null, sum(qty*prc) from sale
union all
select cn, null, pn, sum(qty*prc) from sale group by cn, pn
union all
select null, vn, pn, sum(qty*prc) from sale group by vn, pn
union all
select null, vn, null, sum(qty*prc) from sale group by vn
union all
select null, null, pn, sum(qty*prc) from sale group by pn 
order by 1,2,3; -- order 1,2,3
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 10 | 200 |       0
  1 | 10 |     |       0
  1 | 20 | 100 |       0
  1 | 20 |     |       0
  1 | 30 | 300 |       0
  1 | 30 | 500 |      60
  1 | 30 |     |      60
  1 | 50 | 400 |       0
  1 | 50 |     |       0
  1 |    | 100 |       0
  1 |    | 200 |       0
  1 |    | 300 |       0
  1 |    | 400 |       0
  1 |    | 500 |      60
  1 |    |     |      60
  2 | 40 | 100 | 2640000
  2 | 40 |     | 2640000
  2 | 50 | 400 |       0
  2 | 50 |     |       0
  2 |    | 100 | 2640000
  2 |    | 400 |       0
  2 |    |     | 2640000
  3 | 30 | 500 |      60
  3 | 30 | 600 |      60
  3 | 30 |     |     120
  3 | 40 | 200 |       0
  3 | 40 |     |       0
  3 |    | 200 |       0
  3 |    | 500 |      60
  3 |    | 600 |      60
  3 |    |     |     120
  4 | 40 | 700 |       1
  4 | 40 | 800 |       1
  4 | 40 |     |       2
  4 |    | 700 |       1
  4 |    | 800 |       1
  4 |    |     |       2
    | 10 | 200 |       0
    | 10 |     |       0
    | 20 | 100 |       0
    | 20 |     |       0
    | 30 | 300 |       0
    | 30 | 500 |     120
    | 30 | 600 |      60
    | 30 |     |     180
    | 40 | 100 | 2640000
    | 40 | 200 |       0
    | 40 | 700 |       1
    | 40 | 800 |       1
    | 40 |     | 2640002
    | 50 | 400 |       0
    | 50 |     |       0
    |    | 100 | 2640000
    |    | 200 |       0
    |    | 300 |       0
    |    | 400 |       0
    |    | 500 |     120
    |    | 600 |      60
    |    | 700 |       1
    |    | 800 |       1
    |    |     | 2640182
(61 rows)

select cn, vn, pn, sum(qty*prc) from sale group by cube (cn, vn, pn) order by 1,2,3; -- order 1,2,3
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 10 | 200 |       0
  1 | 10 |     |       0
  1 | 20 | 100 |       0
  1 | 20 |     |       0
  1 | 30 | 300 |       0
  1 | 30 | 500 |      60
  1 | 30 |     |      60
  1 | 50 | 400 |       0
  1 | 50 |     |       0
  1 |    | 100 |       0
  1 |    | 200 |       0
  1 |    | 300 |       0
  1 |    | 400 |       0
  1 |    | 500 |      60
  1 |    |     |      60
  2 | 40 | 100 | 2640000
  2 | 40 |     | 2640000
  2 | 50 | 400 |       0
  2 | 50 |     |       0
  2 |    | 100 | 2640000
  2 |    | 400 |       0
  2 |    |     | 2640000
  3 | 30 | 500 |      60
  3 | 30 | 600 |      60
  3 | 30 |     |     120
  3 | 40 | 200 |       0
  3 | 40 |     |       0
  3 |    | 200 |       0
  3 |    | 500 |      60
  3 |    | 600 |      60
  3 |    |     |     120
  4 | 40 | 700 |       1
  4 | 40 | 800 |       1
  4 | 40 |     |       2
  4 |    | 700 |       1
  4 |    | 800 |       1
  4 |    |     |       2
    | 10 | 200 |       0
    | 10 |     |       0
    | 20 | 100 |       0
    | 20 |     |       0
    | 30 | 300 |       0
    | 30 | 500 |     120
    | 30 | 600 |      60
    | 30 |     |     180
    | 40 | 100 | 2640000
    | 40 | 200 |       0
    | 40 | 700 |       1
    | 40 | 800 |       1
    | 40 |     | 2640002
    | 50 | 400 |       0
    | 50 |     |       0
    |    | 100 | 2640000
    |    | 200 |       0
    |    | 300 |       0
    |    | 400 |       0
    |    | 500 |     120
    |    | 600 |      60
    |    | 700 |       1
    |    | 800 |       1
    |    |     | 2640182
(61 rows)

select cn, vn, pn, sum(qty*prc) from sale group by grouping sets ((), (cn), (vn), (pn), (cn,vn), (cn,pn), (vn,pn), (cn,vn,pn)) order by 1,2,3; -- order 1,2,3
 cn | vn | pn  |   sum   
----+----+-----+---------
  1 | 10 | 200 |       0
  1 | 10 |     |       0
  1 | 20 | 100 |       0
  1 | 20 |     |       0
  1 | 30 | 300 |       0
  1 | 30 | 500 |      60
  1 | 30 |     |      60
  1 | 50 | 400 |       0
  1 | 50 |     |       0
  1 |    | 100 |       0
  1 |    | 200 |       0
  1 |    | 300 |       0
  1 |    | 400 |       0
  1 |    | 500 |      60
  1 |    |     |      60
  2 | 40 | 100 | 2640000
  2 | 40 |     | 2640000
  2 | 50 | 400 |       0
  2 | 50 |     |       0
  2 |    | 100 | 2640000
  2 |    | 400 |       0
  2 |    |     | 2640000
  3 | 30 | 500 |      60
  3 | 30 | 600 |      60
  3 | 30 |     |     120
  3 | 40 | 200 |       0
  3 | 40 |     |       0
  3 |    | 200 |       0
  3 |    | 500 |      60
  3 |    | 600 |      60
  3 |    |     |     120
  4 | 40 | 700 |       1
  4 | 40 | 800 |       1
  4 | 40 |     |       2
  4 |    | 700 |       1
  4 |    | 800 |       1
  4 |    |     |       2
    | 10 | 200 |       0
    | 10 |     |       0
    | 20 | 100 |       0
    | 20 |     |       0
    | 30 | 300 |       0
    | 30 | 500 |     120
    | 30 | 600 |      60
    | 30 |     |     180
    | 40 | 100 | 2640000
    | 40 | 200 |       0
    | 40 | 700 |       1
    | 40 | 800 |       1
    | 40 |     | 2640002
    | 50 | 400 |       0
    | 50 |     |       0
    |    | 100 | 2640000
    |    | 200 |       0
    |    | 300 |       0
    |    | 400 |       0
    |    | 500 |     120
    |    | 600 |      60
    |    | 700 |       1
    |    | 800 |       1
    |    |     | 2640182
(61 rows)

--end_equiv
-- ***BUG*** The extended groupings aren't correctly ordered! Maybe they wrongly parallel sorted!
--start_equiv order 1,2,3
select cn, vn, pn, count(distinct dt) from sale group by cn, vn, pn
union all
select cn, vn, null, count(distinct dt) from sale group by cn, vn
union all
select cn, null, null, count(distinct dt) from sale group by cn
union all
select null, null, null, count(distinct dt) from sale 
order by 1,2,3; -- order 1,2,3
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 10 |     |     1
  1 | 20 | 100 |     1
  1 | 20 |     |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 30 |     |     2
  1 | 50 | 400 |     1
  1 | 50 |     |     1
  1 |    |     |     4
  2 | 40 | 100 |     1
  2 | 40 |     |     1
  2 | 50 | 400 |     1
  2 | 50 |     |     1
  2 |    |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 30 |     |     1
  3 | 40 | 200 |     1
  3 | 40 |     |     1
  3 |    |     |     2
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  4 | 40 |     |     1
  4 |    |     |     1
    |    |     |     6
(26 rows)

select cn, vn, pn, count(distinct dt) from sale group by rollup(cn,vn,pn) order by 1,2,3; -- order 1,2,3
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 10 |     |     1
  1 | 20 | 100 |     1
  1 | 20 |     |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 30 |     |     2
  1 | 50 | 400 |     1
  1 | 50 |     |     1
  1 |    |     |     4
  2 | 40 | 100 |     1
  2 | 40 |     |     1
  2 | 50 | 400 |     1
  2 | 50 |     |     1
  2 |    |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 30 |     |     1
  3 | 40 | 200 |     1
  3 | 40 |     |     1
  3 |    |     |     2
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  4 | 40 |     |     1
  4 |    |     |     1
    |    |     |     6
(26 rows)

select cn, vn, pn, count(distinct dt) from sale group by grouping sets((), (cn), (cn,vn), (cn,vn,pn)) order by 1,2,3; -- order 1,2,3
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 10 |     |     1
  1 | 20 | 100 |     1
  1 | 20 |     |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 30 |     |     2
  1 | 50 | 400 |     1
  1 | 50 |     |     1
  1 |    |     |     4
  2 | 40 | 100 |     1
  2 | 40 |     |     1
  2 | 50 | 400 |     1
  2 | 50 |     |     1
  2 |    |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 30 |     |     1
  3 | 40 | 200 |     1
  3 | 40 |     |     1
  3 |    |     |     2
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  4 | 40 |     |     1
  4 |    |     |     1
    |    |     |     6
(26 rows)

--end_equiv
--start_equiv order 1,2,3
select cn, vn, pn, count(distinct dt) from sale group by cn, vn, pn
union all
select cn, vn, null, count(distinct dt) from sale group by cn, vn
union all
select cn, null, null, count(distinct dt) from sale group by cn
union all
select null, null, null, count(distinct dt) from sale
union all
select cn, null, pn, count(distinct dt) from sale group by cn, pn
union all
select null, vn, pn, count(distinct dt) from sale group by vn, pn
union all
select null, vn, null, count(distinct dt) from sale group by vn
union all
select null, null, pn, count(distinct dt) from sale group by pn 
order by 1,2,3; -- order 1,2,3
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 10 |     |     1
  1 | 20 | 100 |     1
  1 | 20 |     |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 30 |     |     2
  1 | 50 | 400 |     1
  1 | 50 |     |     1
  1 |    | 100 |     1
  1 |    | 200 |     1
  1 |    | 300 |     1
  1 |    | 400 |     1
  1 |    | 500 |     1
  1 |    |     |     4
  2 | 40 | 100 |     1
  2 | 40 |     |     1
  2 | 50 | 400 |     1
  2 | 50 |     |     1
  2 |    | 100 |     1
  2 |    | 400 |     1
  2 |    |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 30 |     |     1
  3 | 40 | 200 |     1
  3 | 40 |     |     1
  3 |    | 200 |     1
  3 |    | 500 |     1
  3 |    | 600 |     1
  3 |    |     |     2
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  4 | 40 |     |     1
  4 |    | 700 |     1
  4 |    | 800 |     1
  4 |    |     |     1
    | 10 | 200 |     1
    | 10 |     |     1
    | 20 | 100 |     1
    | 20 |     |     1
    | 30 | 300 |     1
    | 30 | 500 |     1
    | 30 | 600 |     1
    | 30 |     |     2
    | 40 | 100 |     1
    | 40 | 200 |     1
    | 40 | 700 |     1
    | 40 | 800 |     1
    | 40 |     |     3
    | 50 | 400 |     1
    | 50 |     |     1
    |    | 100 |     2
    |    | 200 |     2
    |    | 300 |     1
    |    | 400 |     1
    |    | 500 |     1
    |    | 600 |     1
    |    | 700 |     1
    |    | 800 |     1
    |    |     |     6
(61 rows)

select cn, vn, pn, count(distinct dt) from sale group by cube (cn, vn, pn) order by 1,2,3; -- order 1,2,3
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 10 |     |     1
  1 | 20 | 100 |     1
  1 | 20 |     |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 30 |     |     2
  1 | 50 | 400 |     1
  1 | 50 |     |     1
  1 |    | 100 |     1
  1 |    | 200 |     1
  1 |    | 300 |     1
  1 |    | 400 |     1
  1 |    | 500 |     1
  1 |    |     |     4
  2 | 40 | 100 |     1
  2 | 40 |     |     1
  2 | 50 | 400 |     1
  2 | 50 |     |     1
  2 |    | 100 |     1
  2 |    | 400 |     1
  2 |    |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 30 |     |     1
  3 | 40 | 200 |     1
  3 | 40 |     |     1
  3 |    | 200 |     1
  3 |    | 500 |     1
  3 |    | 600 |     1
  3 |    |     |     2
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  4 | 40 |     |     1
  4 |    | 700 |     1
  4 |    | 800 |     1
  4 |    |     |     1
    | 10 | 200 |     1
    | 10 |     |     1
    | 20 | 100 |     1
    | 20 |     |     1
    | 30 | 300 |     1
    | 30 | 500 |     1
    | 30 | 600 |     1
    | 30 |     |     2
    | 40 | 100 |     1
    | 40 | 200 |     1
    | 40 | 700 |     1
    | 40 | 800 |     1
    | 40 |     |     3
    | 50 | 400 |     1
    | 50 |     |     1
    |    | 100 |     2
    |    | 200 |     2
    |    | 300 |     1
    |    | 400 |     1
    |    | 500 |     1
    |    | 600 |     1
    |    | 700 |     1
    |    | 800 |     1
    |    |     |     6
(61 rows)

select cn, vn, pn, count(distinct dt) from sale group by grouping sets ((), (cn), (vn), (pn), (cn,vn), (cn,pn), (vn,pn), (cn,vn,pn)) order by 1,2,3; -- order 1,2,3
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 10 |     |     1
  1 | 20 | 100 |     1
  1 | 20 |     |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 30 |     |     2
  1 | 50 | 400 |     1
  1 | 50 |     |     1
  1 |    | 100 |     1
  1 |    | 200 |     1
  1 |    | 300 |     1
  1 |    | 400 |     1
  1 |    | 500 |     1
  1 |    |     |     4
  2 | 40 | 100 |     1
  2 | 40 |     |     1
  2 | 50 | 400 |     1
  2 | 50 |     |     1
  2 |    | 100 |     1
  2 |    | 400 |     1
  2 |    |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 30 |     |     1
  3 | 40 | 200 |     1
  3 | 40 |     |     1
  3 |    | 200 |     1
  3 |    | 500 |     1
  3 |    | 600 |     1
  3 |    |     |     2
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  4 | 40 |     |     1
  4 |    | 700 |     1
  4 |    | 800 |     1
  4 |    |     |     1
    | 10 | 200 |     1
    | 10 |     |     1
    | 20 | 100 |     1
    | 20 |     |     1
    | 30 | 300 |     1
    | 30 | 500 |     1
    | 30 | 600 |     1
    | 30 |     |     2
    | 40 | 100 |     1
    | 40 | 200 |     1
    | 40 | 700 |     1
    | 40 | 800 |     1
    | 40 |     |     3
    | 50 | 400 |     1
    | 50 |     |     1
    |    | 100 |     2
    |    | 200 |     2
    |    | 300 |     1
    |    | 400 |     1
    |    | 500 |     1
    |    | 600 |     1
    |    | 700 |     1
    |    | 800 |     1
    |    |     |     6
(61 rows)

--end_equiv
-- Ordinary Grouping Set Specifications --
select cn, count(*) from sale group by cn;
 cn | count 
----+-------
  1 |     5
  2 |     2
  3 |     3
  4 |     2
(4 rows)

select cn, count(*) from sale group by (cn);
 cn | count 
----+-------
  3 |     3
  1 |     5
  4 |     2
  2 |     2
(4 rows)

select cn,pn,count(*) from sale group by cn,pn;
 cn | pn  | count 
----+-----+-------
  1 | 100 |     1
  1 | 200 |     1
  3 | 200 |     1
  2 | 400 |     1
  3 | 600 |     1
  4 | 800 |     1
  2 | 100 |     1
  1 | 300 |     1
  1 | 400 |     1
  3 | 500 |     1
  1 | 500 |     1
  4 | 700 |     1
(12 rows)

select cn,pn,count(*) from sale group by (cn),pn;
 cn | pn  | count 
----+-----+-------
  1 | 100 |     1
  1 | 200 |     1
  3 | 200 |     1
  2 | 400 |     1
  3 | 600 |     1
  4 | 800 |     1
  2 | 100 |     1
  1 | 300 |     1
  1 | 400 |     1
  3 | 500 |     1
  1 | 500 |     1
  4 | 700 |     1
(12 rows)

select cn,pn,count(*) from sale group by cn,(pn);
 cn | pn  | count 
----+-----+-------
  1 | 100 |     1
  1 | 200 |     1
  3 | 200 |     1
  2 | 400 |     1
  3 | 600 |     1
  4 | 800 |     1
  2 | 100 |     1
  1 | 300 |     1
  1 | 400 |     1
  3 | 500 |     1
  1 | 500 |     1
  4 | 700 |     1
(12 rows)

select cn,pn,count(*) from sale group by (cn),(pn);
 cn | pn  | count 
----+-----+-------
  1 | 100 |     1
  1 | 200 |     1
  3 | 200 |     1
  2 | 400 |     1
  3 | 600 |     1
  4 | 800 |     1
  2 | 100 |     1
  1 | 300 |     1
  1 | 400 |     1
  3 | 500 |     1
  1 | 500 |     1
  4 | 700 |     1
(12 rows)

select cn+vn as a, vn+pn as b, count(*) from sale group by (cn+vn), (vn+pn);
 a  |  b  | count 
----+-----+-------
 21 | 120 |     1
 43 | 240 |     1
 11 | 210 |     1
 52 | 450 |     1
 31 | 530 |     1
 33 | 630 |     1
 33 | 530 |     1
 44 | 840 |     1
 42 | 140 |     1
 31 | 330 |     1
 51 | 450 |     1
 44 | 740 |     1
(12 rows)

select cn+vn as a, vn+pn as b, count(*) from sale group by (1), (2);
 a  |  b  | count 
----+-----+-------
 21 | 120 |     1
 43 | 240 |     1
 11 | 210 |     1
 52 | 450 |     1
 31 | 530 |     1
 33 | 630 |     1
 33 | 530 |     1
 44 | 840 |     1
 42 | 140 |     1
 31 | 330 |     1
 51 | 450 |     1
 44 | 740 |     1
(12 rows)

select cn+vn as a, vn+pn as b, count(*) from sale group by (a), (b);
 a  |  b  | count 
----+-----+-------
 21 | 120 |     1
 43 | 240 |     1
 11 | 210 |     1
 52 | 450 |     1
 31 | 530 |     1
 33 | 630 |     1
 33 | 530 |     1
 44 | 840 |     1
 42 | 140 |     1
 31 | 330 |     1
 51 | 450 |     1
 44 | 740 |     1
(12 rows)

select cn+vn as a, vn+pn as b, count(*) from sale group by a, b;
 a  |  b  | count 
----+-----+-------
 21 | 120 |     1
 43 | 240 |     1
 11 | 210 |     1
 52 | 450 |     1
 31 | 530 |     1
 33 | 630 |     1
 33 | 530 |     1
 44 | 840 |     1
 42 | 140 |     1
 31 | 330 |     1
 51 | 450 |     1
 44 | 740 |     1
(12 rows)

select cn+vn as a, vn+pn as b, count(*) from sale group by (cn+vn, vn+pn);
 a  |  b  | count 
----+-----+-------
 21 | 120 |     1
 43 | 240 |     1
 11 | 210 |     1
 52 | 450 |     1
 31 | 530 |     1
 33 | 630 |     1
 33 | 530 |     1
 44 | 840 |     1
 42 | 140 |     1
 31 | 330 |     1
 51 | 450 |     1
 44 | 740 |     1
(12 rows)

select cn+vn as a, vn+pn as b, count(*) from sale group by (1, 2);
 a  |  b  | count 
----+-----+-------
 21 | 120 |     1
 43 | 240 |     1
 11 | 210 |     1
 52 | 450 |     1
 31 | 530 |     1
 33 | 630 |     1
 33 | 530 |     1
 44 | 840 |     1
 42 | 140 |     1
 31 | 330 |     1
 51 | 450 |     1
 44 | 740 |     1
(12 rows)

select cn+vn as a, vn+pn as b, count(*) from sale group by (a, b);
 a  |  b  | count 
----+-----+-------
 21 | 120 |     1
 43 | 240 |     1
 11 | 210 |     1
 52 | 450 |     1
 31 | 530 |     1
 33 | 630 |     1
 33 | 530 |     1
 44 | 840 |     1
 42 | 140 |     1
 31 | 330 |     1
 51 | 450 |     1
 44 | 740 |     1
(12 rows)

select cn,vn,pn,count(*) from sale group by cn,(vn,pn);
 cn | vn | pn  | count 
----+----+-----+-------
  4 | 40 | 800 |     1
  3 | 30 | 600 |     1
  2 | 50 | 400 |     1
  1 | 10 | 200 |     1
  3 | 40 | 200 |     1
  1 | 20 | 100 |     1
  4 | 40 | 700 |     1
  1 | 50 | 400 |     1
  1 | 30 | 500 |     1
  3 | 30 | 500 |     1
  1 | 30 | 300 |     1
  2 | 40 | 100 |     1
(12 rows)

select count(*) from sale group by rollup((cn,vn),(pn,dt));
 count 
-------
     1
     1
     1
     1
     1
     1
     2
     1
     1
     1
     1
     1
     1
     1
     1
     2
     1
     1
     1
     1
     2
    12
(22 rows)

-- Distinguish grouping value NULLs from summarization NULLs --
create table olap_tmp_for_group (a int, b int, c int);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
insert into olap_tmp_for_group values (1,1,1),(1,2,1),(1,2,1),(2,1,1),(2,2,1);
--start_equiv
select * from olap_tmp_for_group;
 a | b | c 
---+---+---
 1 | 1 | 1
 1 | 2 | 1
 1 | 2 | 1
 2 | 1 | 1
 2 | 2 | 1
(5 rows)

select * from (values (1,1,1),(1,2,1),(1,2,1),(2,1,1),(2,2,1)) r(a,b,c);
 a | b | c 
---+---+---
 1 | 1 | 1
 1 | 2 | 1
 1 | 2 | 1
 2 | 1 | 1
 2 | 2 | 1
(5 rows)

--end_equiv
--start_equiv
select a,b,sum(c) from olap_tmp_for_group group by rollup(a,b);
 a | b | sum 
---+---+-----
 1 | 1 |   1
 1 | 2 |   2
 1 |   |   3
 2 | 1 |   1
 2 | 2 |   1
 2 |   |   2
   |   |   5
(7 rows)

select * from (values (1,1,1), (1,2,2), (1,null,3), (2,1,1), (2,2,1),(2,null,2),(null,null,5)) r(a,b,"sum");
 a | b | sum 
---+---+-----
 1 | 1 |   1
 1 | 2 |   2
 1 |   |   3
 2 | 1 |   1
 2 | 2 |   1
 2 |   |   2
   |   |   5
(7 rows)

--end_equiv
insert into olap_tmp_for_group values (1,null,1);
--start_equiv
select a,b,sum(c) from olap_tmp_for_group group by rollup(a,b);
 a | b | sum 
---+---+-----
 1 | 1 |   1
 1 | 2 |   2
 1 |   |   1
 1 |   |   4
 2 | 1 |   1
 2 | 2 |   1
 2 |   |   2
   |   |   6
(8 rows)

select * from (values (1,1,1), (1,2,2), (1,null,1), (1,null,4), (2,1,1), (2,2,1), (2,null,2), (null,null,6)) r(a,b,"sum");
 a | b | sum 
---+---+-----
 1 | 1 |   1
 1 | 2 |   2
 1 |   |   1
 1 |   |   4
 2 | 1 |   1
 2 | 2 |   1
 2 |   |   2
   |   |   6
(8 rows)

--end_equiv
insert into olap_tmp_for_group values (null,null,1);
--start_equiv
select a,b,sum(c) from olap_tmp_for_group group by rollup(a,b);
 a | b | sum 
---+---+-----
 1 | 1 |   1
 1 | 2 |   2
 1 |   |   1
 1 |   |   4
 2 | 1 |   1
 2 | 2 |   1
 2 |   |   2
   |   |   1
   |   |   1
   |   |   7
(10 rows)

select * from (values (1,1,1), (1,2,2), (1,null,1), (1,null,4), (2,1,1), (2,2,1), (2,null,2), (null,null,1), (null,null,1), (null,null,7)) r(a,b,"sum");
 a | b | sum 
---+---+-----
 1 | 1 |   1
 1 | 2 |   2
 1 |   |   1
 1 |   |   4
 2 | 1 |   1
 2 | 2 |   1
 2 |   |   2
   |   |   1
   |   |   1
   |   |   7
(10 rows)

--end_equiv
drop table olap_tmp_for_group; --ignore
-- Grouping extension combination
--start_equiv
select cn,vn,sum(qty) from sale group by cn,vn union all
select cn,null,sum(qty) from sale group by cn union all
select cn,null,sum(qty) from sale group by cn union all
select null,null,sum(qty) from sale;
 cn | vn | sum  
----+----+------
  1 | 10 |    1
  1 | 20 |    1
  3 | 30 |   24
  1 | 30 |   13
  3 | 40 |    1
  1 | 50 |    1
  3 |    |   25
  1 |    |   16
  3 |    |   25
  1 |    |   16
  4 | 40 |    2
  2 | 40 | 1100
  2 | 50 |    1
  4 |    |    2
  2 |    | 1101
  4 |    |    2
  2 |    | 1101
    |    | 1144
(18 rows)

select cn,vn,sum(qty) from sale group by grouping sets (rollup(cn,vn), cn);
 cn | vn | sum  
----+----+------
    |    | 1144
  1 |    |   16
  1 |    |   16
  1 | 10 |    1
  1 | 20 |    1
  1 | 30 |   13
  1 | 50 |    1
  2 |    | 1101
  2 |    | 1101
  2 | 40 | 1100
  2 | 50 |    1
  3 |    |   25
  3 |    |   25
  3 | 30 |   24
  3 | 40 |    1
  4 |    |    2
  4 |    |    2
  4 | 40 |    2
(18 rows)

--end_equiv
--start_equiv
select cn,vn,sum(qty) from sale group by cn,vn union all
select cn,null,sum(qty) from sale group by cn union all
select null,null,sum(qty) from sale;
 cn | vn | sum  
----+----+------
    |    | 1144
  1 |    |   16
  1 | 10 |    1
  1 | 20 |    1
  1 | 30 |   13
  1 | 50 |    1
  2 |    | 1101
  2 | 40 | 1100
  2 | 50 |    1
  3 |    |   25
  3 | 30 |   24
  3 | 40 |    1
  4 |    |    2
  4 | 40 |    2
(14 rows)

select cn,vn,sum(qty) from sale group by grouping sets (rollup(cn,vn));
 cn | vn | sum  
----+----+------
  1 | 10 |    1
  1 | 20 |    1
  1 | 30 |   13
  1 | 50 |    1
  2 |    | 1101
  3 | 30 |   24
  3 | 40 |    1
  4 |    |    2
  1 |    |   16
  2 | 40 | 1100
  2 | 50 |    1
  3 |    |   25
  4 | 40 |    2
    |    | 1144
(14 rows)

--end_equiv
--start_equiv
select cn,null as vn,sum(qty) from sale group by cn union all
select null as cn,vn,sum(qty) from sale group by vn;
 cn | vn | sum  
----+----+------
  3 |    |   25
  1 |    |   16
  4 |    |    2
  2 |    | 1101
    | 50 |    2
    | 40 | 1103
    | 30 |   37
    | 20 |    1
    | 10 |    1
(9 rows)

select cn,vn,sum(qty) from sale group by grouping sets((cn),(vn));
 cn | vn | sum  
----+----+------
  2 |    | 1101
  4 |    |    2
    | 10 |    1
    | 20 |    1
    | 30 |   37
    | 40 | 1103
    | 50 |    2
  1 |    |   16
  3 |    |   25
(9 rows)

--end_equiv
-- GROUPING function -- 
select grouping(cn,vn,pn) from sale;
ERROR:  column "sale"."cn" is not in GROUP BY
select cn,vn,pn,grouping(cn,vn,pn) from sale group by cn,vn,pn;
 cn | vn | pn  | grouping 
----+----+-----+----------
  1 | 10 | 200 |        0
  1 | 20 | 100 |        0
  1 | 30 | 300 |        0
  1 | 30 | 500 |        0
  1 | 50 | 400 |        0
  2 | 40 | 100 |        0
  2 | 50 | 400 |        0
  3 | 30 | 500 |        0
  3 | 30 | 600 |        0
  3 | 40 | 200 |        0
  4 | 40 | 700 |        0
  4 | 40 | 800 |        0
(12 rows)

select cn,vn,pn,grouping(cn,vn,pn) from sale group by rollup(cn),vn,pn;
 cn | vn | pn  | grouping 
----+----+-----+----------
  4 | 40 | 800 |        0
  3 | 30 | 600 |        0
  2 | 50 | 400 |        0
  1 | 10 | 200 |        0
  3 | 40 | 200 |        0
  1 | 20 | 100 |        0
    | 30 | 300 |        4
    | 30 | 500 |        4
    | 50 | 400 |        4
    | 40 | 800 |        4
  4 | 40 | 700 |        0
  1 | 50 | 400 |        0
  1 | 30 | 500 |        0
  3 | 30 | 500 |        0
  1 | 30 | 300 |        0
  2 | 40 | 100 |        0
    | 40 | 100 |        4
    | 20 | 100 |        4
    | 40 | 200 |        4
    | 10 | 200 |        4
    | 30 | 600 |        4
    | 40 | 700 |        4
(22 rows)

select cn,vn,pn,grouping(cn,vn,pn) from sale group by rollup(cn,vn), pn;
 cn | vn | pn  | grouping 
----+----+-----+----------
  4 | 40 | 800 |        0
  3 | 30 | 600 |        0
  2 | 50 | 400 |        0
  1 | 10 | 200 |        0
  3 | 40 | 200 |        0
  1 | 20 | 100 |        0
  1 |    | 100 |        2
  1 |    | 200 |        2
  3 |    | 200 |        2
  2 |    | 400 |        2
  3 |    | 600 |        2
  4 |    | 800 |        2
    |    | 800 |        6
    |    | 500 |        6
    |    | 400 |        6
    |    | 300 |        6
  4 | 40 | 700 |        0
  1 | 50 | 400 |        0
  1 | 30 | 500 |        0
  3 | 30 | 500 |        0
  1 | 30 | 300 |        0
  2 | 40 | 100 |        0
  2 |    | 100 |        2
  1 |    | 300 |        2
  1 |    | 400 |        2
  3 |    | 500 |        2
  1 |    | 500 |        2
  4 |    | 700 |        2
    |    | 700 |        6
    |    | 600 |        6
    |    | 200 |        6
    |    | 100 |        6
(32 rows)

select cn,vn,pn,grouping(cn,vn,pn) from sale group by rollup(cn,vn,pn);
 cn | vn | pn  | grouping 
----+----+-----+----------
  4 | 40 | 800 |        0
  3 | 30 | 600 |        0
  2 | 50 | 400 |        0
  1 | 10 | 200 |        0
  3 | 40 | 200 |        0
  1 | 20 | 100 |        0
  1 | 10 |     |        1
  1 | 20 |     |        1
  3 | 30 |     |        1
  1 | 30 |     |        1
  3 | 40 |     |        1
  1 | 50 |     |        1
  3 |    |     |        3
  1 |    |     |        3
  4 | 40 | 700 |        0
  1 | 50 | 400 |        0
  1 | 30 | 500 |        0
  3 | 30 | 500 |        0
  1 | 30 | 300 |        0
  2 | 40 | 100 |        0
  4 | 40 |     |        1
  2 | 40 |     |        1
  2 | 50 |     |        1
  4 |    |     |        3
  2 |    |     |        3
    |    |     |        7
(26 rows)

select cn,vn,pn,grouping(cn,vn,pn) from sale group by cn, rollup(vn,pn);
 cn | vn | pn  | grouping 
----+----+-----+----------
  4 | 40 | 800 |        0
  3 | 30 | 600 |        0
  2 | 50 | 400 |        0
  1 | 10 | 200 |        0
  3 | 40 | 200 |        0
  1 | 20 | 100 |        0
  1 | 10 |     |        1
  1 | 20 |     |        1
  3 | 30 |     |        1
  1 | 30 |     |        1
  3 | 40 |     |        1
  1 | 50 |     |        1
  3 |    |     |        3
  1 |    |     |        3
  4 | 40 | 700 |        0
  1 | 50 | 400 |        0
  1 | 30 | 500 |        0
  3 | 30 | 500 |        0
  1 | 30 | 300 |        0
  2 | 40 | 100 |        0
  4 | 40 |     |        1
  2 | 40 |     |        1
  2 | 50 |     |        1
  4 |    |     |        3
  2 |    |     |        3
(25 rows)

select cn,vn,pn,grouping(cn,vn,pn) from sale group by vn, rollup(cn, pn);
 cn | vn | pn  | grouping 
----+----+-----+----------
  4 | 40 | 800 |        0
  3 | 30 | 600 |        0
  2 | 50 | 400 |        0
  1 | 10 | 200 |        0
  3 | 40 | 200 |        0
  1 | 20 | 100 |        0
  1 | 10 |     |        1
  1 | 20 |     |        1
  1 | 30 |     |        1
  3 | 30 |     |        1
  3 | 40 |     |        1
  1 | 50 |     |        1
  4 | 40 | 700 |        0
  1 | 30 | 500 |        0
  3 | 30 | 500 |        0
  1 | 50 | 400 |        0
  1 | 30 | 300 |        0
  2 | 40 | 100 |        0
  2 | 40 |     |        1
  4 | 40 |     |        1
  2 | 50 |     |        1
    | 50 |     |        5
    | 40 |     |        5
    | 30 |     |        5
    | 20 |     |        5
    | 10 |     |        5
(26 rows)

select grouping(cn), grouping(vn), grouping(pn), cn, vn, pn, count(*) from sale group by rollup(cn,vn,pn);
 grouping | grouping | grouping | cn | vn | pn  | count 
----------+----------+----------+----+----+-----+-------
        0 |        0 |        0 |  1 | 10 | 200 |     1
        0 |        0 |        1 |  1 | 10 |     |     1
        0 |        0 |        0 |  1 | 20 | 100 |     1
        0 |        0 |        1 |  1 | 20 |     |     1
        0 |        0 |        0 |  1 | 30 | 300 |     1
        0 |        0 |        0 |  1 | 30 | 500 |     1
        0 |        0 |        1 |  1 | 30 |     |     2
        0 |        0 |        0 |  1 | 50 | 400 |     1
        0 |        0 |        1 |  1 | 50 |     |     1
        0 |        1 |        1 |  1 |    |     |     5
        0 |        0 |        0 |  2 | 40 | 100 |     1
        0 |        0 |        1 |  2 | 40 |     |     1
        0 |        0 |        0 |  2 | 50 | 400 |     1
        0 |        0 |        1 |  2 | 50 |     |     1
        0 |        1 |        1 |  2 |    |     |     2
        0 |        0 |        0 |  3 | 30 | 500 |     1
        0 |        0 |        0 |  3 | 30 | 600 |     1
        0 |        0 |        1 |  3 | 30 |     |     2
        0 |        0 |        0 |  3 | 40 | 200 |     1
        0 |        0 |        1 |  3 | 40 |     |     1
        0 |        1 |        1 |  3 |    |     |     3
        0 |        0 |        0 |  4 | 40 | 700 |     1
        0 |        0 |        0 |  4 | 40 | 800 |     1
        0 |        0 |        1 |  4 | 40 |     |     2
        0 |        1 |        1 |  4 |    |     |     2
        1 |        1 |        1 |    |    |     |    12
(26 rows)

select grouping(cn,vn,pn) from sale group by rollup(cn,vn,pn) order by 1 desc; -- order 1
 grouping 
----------
        7
        3
        3
        3
        3
        1
        1
        1
        1
        1
        1
        1
        1
        1
        0
        0
        0
        0
        0
        0
        0
        0
        0
        0
        0
        0
(26 rows)

select grouping(cn), grouping(vn), grouping(pn) from sale group by rollup(cn,vn,pn) order by 1 desc, 2 desc, 3 desc; -- order 1,2,3
 grouping | grouping | grouping 
----------+----------+----------
        1 |        1 |        1
        0 |        1 |        1
        0 |        1 |        1
        0 |        1 |        1
        0 |        1 |        1
        0 |        0 |        1
        0 |        0 |        1
        0 |        0 |        1
        0 |        0 |        1
        0 |        0 |        1
        0 |        0 |        1
        0 |        0 |        1
        0 |        0 |        1
        0 |        0 |        1
        0 |        0 |        0
        0 |        0 |        0
        0 |        0 |        0
        0 |        0 |        0
        0 |        0 |        0
        0 |        0 |        0
        0 |        0 |        0
        0 |        0 |        0
        0 |        0 |        0
        0 |        0 |        0
        0 |        0 |        0
        0 |        0 |        0
(26 rows)

select cn+vn,pn, grouping(cn+vn,pn), count(*) from sale group by rollup(cn+vn,pn);
 ?column? | pn  | grouping | count 
----------+-----+----------+-------
       11 | 200 |        0 |     1
       21 | 100 |        0 |     1
       33 | 600 |        0 |     1
       42 |     |        1 |     1
       43 | 200 |        0 |     1
       44 | 800 |        0 |     1
       44 |     |        1 |     2
       52 | 400 |        0 |     1
       52 |     |        1 |     1
       11 |     |        1 |     1
       21 |     |        1 |     1
       31 | 300 |        0 |     1
       31 | 500 |        0 |     1
       31 |     |        1 |     2
       33 | 500 |        0 |     1
       33 |     |        1 |     2
       42 | 100 |        0 |     1
       43 |     |        1 |     1
       44 | 700 |        0 |     1
       51 | 400 |        0 |     1
       51 |     |        1 |     1
          |     |        3 |    12
(22 rows)

--start_equiv
select cn,vn,0 as grouping from sale group by cn,vn
union all select cn,null,1 as grouping from sale group by cn
union all (select null,null,3 as grouping from sale limit 1)
union all select null,vn,2 as grouping from sale group by vn;
 cn | vn | grouping 
----+----+----------
    |    |        3
    | 10 |        2
    | 20 |        2
    | 30 |        2
    | 40 |        2
    | 50 |        2
  1 |    |        1
  1 | 10 |        0
  1 | 20 |        0
  1 | 30 |        0
  1 | 50 |        0
  2 |    |        1
  2 | 40 |        0
  2 | 50 |        0
  3 |    |        1
  3 | 30 |        0
  3 | 40 |        0
  4 |    |        1
  4 | 40 |        0
(19 rows)

select cn,vn,grouping(cn,vn) from sale group by cube(cn,vn);
 cn | vn | grouping 
----+----+----------
  1 | 10 |        0
    | 10 |        2
  1 | 20 |        0
    | 20 |        2
  1 | 30 |        0
  3 | 30 |        0
    | 30 |        2
  2 | 40 |        0
  3 | 40 |        0
  4 | 40 |        0
    | 40 |        2
  1 | 50 |        0
  2 | 50 |        0
    | 50 |        2
    |    |        3
  1 |    |        1
  2 |    |        1
  3 |    |        1
  4 |    |        1
(19 rows)

select cn,vn,grouping(cn,vn) from sale group by cube(vn,cn);
 cn | vn | grouping 
----+----+----------
  1 | 10 |        0
  1 | 20 |        0
  1 | 30 |        0
  1 | 50 |        0
  1 |    |        1
  2 | 40 |        0
  2 | 50 |        0
  2 |    |        1
  3 | 30 |        0
  3 | 40 |        0
  3 |    |        1
  4 | 40 |        0
  4 |    |        1
    |    |        3
    | 10 |        2
    | 20 |        2
    | 30 |        2
    | 40 |        2
    | 50 |        2
(19 rows)

select cn,vn,grouping(cn,vn) from sale group by grouping sets ((vn,cn), (vn), (cn), ());
 cn | vn | grouping 
----+----+----------
  1 | 10 |        0
  1 | 20 |        0
  1 | 30 |        0
  1 | 50 |        0
  1 |    |        1
  2 | 40 |        0
  2 | 50 |        0
  2 |    |        1
  3 | 30 |        0
  3 | 40 |        0
  3 |    |        1
  4 | 40 |        0
  4 |    |        1
    |    |        3
    | 10 |        2
    | 20 |        2
    | 30 |        2
    | 40 |        2
    | 50 |        2
(19 rows)

select cn,vn,grouping(cn,vn) from sale group by grouping sets ((),(vn,cn), (vn), (cn));
 cn | vn | grouping 
----+----+----------
  1 | 10 |        0
  1 | 20 |        0
  1 | 30 |        0
  1 | 50 |        0
  1 |    |        1
  2 | 40 |        0
  2 | 50 |        0
  2 |    |        1
  3 | 30 |        0
  3 | 40 |        0
  3 |    |        1
  4 | 40 |        0
  4 |    |        1
    |    |        3
    | 10 |        2
    | 20 |        2
    | 30 |        2
    | 40 |        2
    | 50 |        2
(19 rows)

--end_equiv
--start_equiv
select cn,vn,0 as grouping from sale group by cn,vn
union all select cn,null,2 as grouping from sale group by cn
union all (select null,null,3 as grouping from sale limit 1)
union all select null,vn,1 as grouping from sale group by vn;
 cn | vn | grouping 
----+----+----------
  1 | 10 |        0
  1 | 20 |        0
  3 | 30 |        0
  1 | 30 |        0
  3 | 40 |        0
  1 | 50 |        0
  3 |    |        2
  1 |    |        2
    |    |        3
  4 | 40 |        0
  2 | 40 |        0
  2 | 50 |        0
  4 |    |        2
  2 |    |        2
    | 50 |        1
    | 40 |        1
    | 30 |        1
    | 20 |        1
    | 10 |        1
(19 rows)

select cn,vn,grouping(vn,cn) from sale group by cube(cn,vn);
 cn | vn | grouping 
----+----+----------
  1 | 10 |        0
    | 10 |        1
  1 | 20 |        0
    | 20 |        1
  1 | 30 |        0
  3 | 30 |        0
    | 30 |        1
  2 | 40 |        0
  3 | 40 |        0
  4 | 40 |        0
    | 40 |        1
  1 | 50 |        0
  2 | 50 |        0
    | 50 |        1
    |    |        3
  1 |    |        2
  2 |    |        2
  3 |    |        2
  4 |    |        2
(19 rows)

select cn,vn,grouping(vn,cn) from sale group by cube(vn,cn);
 cn | vn | grouping 
----+----+----------
  1 | 10 |        0
  1 | 20 |        0
  1 | 30 |        0
  1 | 50 |        0
  1 |    |        2
  2 | 40 |        0
  2 | 50 |        0
  2 |    |        2
  3 | 30 |        0
  3 | 40 |        0
  3 |    |        2
  4 | 40 |        0
  4 |    |        2
    |    |        3
    | 10 |        1
    | 20 |        1
    | 30 |        1
    | 40 |        1
    | 50 |        1
(19 rows)

select cn,vn,grouping(vn,cn) from sale group by grouping sets ((vn,cn), (vn), (cn), ());
 cn | vn | grouping 
----+----+----------
  1 | 10 |        0
  1 | 20 |        0
  1 | 30 |        0
  1 | 50 |        0
  1 |    |        2
  2 | 40 |        0
  2 | 50 |        0
  2 |    |        2
  3 | 30 |        0
  3 | 40 |        0
  3 |    |        2
  4 | 40 |        0
  4 |    |        2
    |    |        3
    | 10 |        1
    | 20 |        1
    | 30 |        1
    | 40 |        1
    | 50 |        1
(19 rows)

select cn,vn,grouping(vn,cn) from sale group by grouping sets ((vn), (cn), (), (cn,vn));
 cn | vn | grouping 
----+----+----------
  1 | 10 |        0
  1 | 20 |        0
  1 | 30 |        0
  1 | 50 |        0
  1 |    |        2
  2 | 40 |        0
  2 | 50 |        0
  2 |    |        2
  3 | 30 |        0
  3 | 40 |        0
  3 |    |        2
  4 | 40 |        0
  4 |    |        2
    |    |        3
    | 10 |        1
    | 20 |        1
    | 30 |        1
    | 40 |        1
    | 50 |        1
(19 rows)

--end_equiv
--start_equiv
select cn,dt,0 as grouping from sale group by cn,dt
union all select cn,null,1 as grouping from sale group by cn
union all (select null,null,3 as grouping from sale limit 1)
union all select null,dt,2 as grouping from sale group by dt;
 cn |     dt     | grouping 
----+------------+----------
  3 | 04-01-1401 |        0
  1 | 05-01-1401 |        0
  4 | 06-01-1401 |        0
  2 | 06-01-1401 |        0
  3 |            |        1
  1 |            |        1
    |            |        3
    | 06-01-1401 |        2
    | 05-02-1401 |        2
    | 03-01-1401 |        2
  2 | 01-01-1401 |        0
  1 | 03-01-1401 |        0
  1 | 05-02-1401 |        0
  1 | 06-01-1401 |        0
  3 | 06-01-1401 |        0
  4 |            |        1
  2 |            |        1
    | 05-01-1401 |        2
    | 04-01-1401 |        2
    | 01-01-1401 |        2
(20 rows)

select cn,dt,grouping(cn,dt) from sale group by cube(cn,dt);
 cn |     dt     | grouping 
----+------------+----------
  2 | 01-01-1401 |        0
    | 01-01-1401 |        2
  1 | 03-01-1401 |        0
    | 03-01-1401 |        2
  3 | 04-01-1401 |        0
    | 04-01-1401 |        2
  1 | 05-01-1401 |        0
    | 05-01-1401 |        2
  1 | 05-02-1401 |        0
    | 05-02-1401 |        2
  1 | 06-01-1401 |        0
  2 | 06-01-1401 |        0
  3 | 06-01-1401 |        0
  4 | 06-01-1401 |        0
    | 06-01-1401 |        2
    |            |        3
  1 |            |        1
  2 |            |        1
  3 |            |        1
  4 |            |        1
(20 rows)

select cn,dt,grouping(cn,dt) from sale group by cube(dt,cn);
 cn |     dt     | grouping 
----+------------+----------
  1 | 03-01-1401 |        0
  1 | 05-01-1401 |        0
  1 | 05-02-1401 |        0
  1 | 06-01-1401 |        0
  1 |            |        1
  2 | 01-01-1401 |        0
  2 | 06-01-1401 |        0
  2 |            |        1
  3 | 04-01-1401 |        0
  3 | 06-01-1401 |        0
  3 |            |        1
  4 | 06-01-1401 |        0
  4 |            |        1
    |            |        3
    | 01-01-1401 |        2
    | 03-01-1401 |        2
    | 04-01-1401 |        2
    | 05-01-1401 |        2
    | 05-02-1401 |        2
    | 06-01-1401 |        2
(20 rows)

--end_equiv
--start_equiv
select cn,dt,count(vn),0 as grouping from sale group by cn,dt
union all select cn,null,count(vn),1 as grouping from sale group by cn
union all (select null,null,count(vn),3 as grouping from sale limit 1)
union all select null,dt,count(vn),2 as grouping from sale group by dt;
 cn |     dt     | count | grouping 
----+------------+-------+----------
  3 | 04-01-1401 |     1 |        0
  1 | 05-01-1401 |     1 |        0
  4 | 06-01-1401 |     2 |        0
  2 | 06-01-1401 |     1 |        0
  3 |            |     3 |        1
  1 |            |     5 |        1
    |            |    12 |        3
    | 06-01-1401 |     7 |        2
    | 05-02-1401 |     1 |        2
    | 03-01-1401 |     1 |        2
  2 | 01-01-1401 |     1 |        0
  1 | 03-01-1401 |     1 |        0
  1 | 05-02-1401 |     1 |        0
  1 | 06-01-1401 |     2 |        0
  3 | 06-01-1401 |     2 |        0
  4 |            |     2 |        1
  2 |            |     2 |        1
    | 05-01-1401 |     1 |        2
    | 04-01-1401 |     1 |        2
    | 01-01-1401 |     1 |        2
(20 rows)

select cn,dt,count(vn),grouping(cn,dt) from sale group by cube(cn,dt);
 cn |     dt     | count | grouping 
----+------------+-------+----------
  1 | 05-01-1401 |     1 |        0
  2 | 06-01-1401 |     1 |        0
  2 |            |     2 |        1
  3 | 04-01-1401 |     1 |        0
  4 | 06-01-1401 |     2 |        0
  4 |            |     2 |        1
    | 01-01-1401 |     1 |        2
    | 04-01-1401 |     1 |        2
    | 05-01-1401 |     1 |        2
  1 | 03-01-1401 |     1 |        0
  1 | 05-02-1401 |     1 |        0
  1 | 06-01-1401 |     2 |        0
  1 |            |     5 |        1
  2 | 01-01-1401 |     1 |        0
  3 | 06-01-1401 |     2 |        0
  3 |            |     3 |        1
    | 03-01-1401 |     1 |        2
    | 05-02-1401 |     1 |        2
    | 06-01-1401 |     7 |        2
    |            |    12 |        3
(20 rows)

select cn,dt,count(vn),grouping(cn,dt) from sale group by cube(dt,cn);
 cn |     dt     | count | grouping 
----+------------+-------+----------
    | 01-01-1401 |     1 |        2
  3 | 04-01-1401 |     1 |        0
    | 04-01-1401 |     1 |        2
  1 | 05-01-1401 |     1 |        0
    | 05-01-1401 |     1 |        2
  2 | 06-01-1401 |     1 |        0
  4 | 06-01-1401 |     2 |        0
  2 |            |     2 |        1
  4 |            |     2 |        1
  2 | 01-01-1401 |     1 |        0
  1 | 03-01-1401 |     1 |        0
    | 03-01-1401 |     1 |        2
  1 | 05-02-1401 |     1 |        0
    | 05-02-1401 |     1 |        2
  1 | 06-01-1401 |     2 |        0
  3 | 06-01-1401 |     2 |        0
    | 06-01-1401 |     7 |        2
  1 |            |     5 |        1
  3 |            |     3 |        1
    |            |    12 |        3
(20 rows)

--end_equiv
--start_equiv
select cn,sum(qty) from sale group by prc,cn
union all select null,sum(qty) from sale group by prc
union all select cn,sum(qty) from sale group by cn
union all select null,sum(qty) from sale;
 cn | sum  
----+------
  3 |    1
  1 |    4
  4 |    2
  3 |   24
  1 |   12
    |    2
  3 |   25
  1 |   16
    | 1144
  2 |    1
  2 | 1100
    |    6
    |   36
    | 1100
  4 |    2
  2 | 1101
(16 rows)

select cn,sum(qty) from sale group by cube(prc,cn);
 cn | sum  
----+------
  3 |    1
  1 |    4
  4 |    2
  3 |   24
  1 |   12
    |    2
  3 |   25
  1 |   16
    | 1144
  2 |    1
  2 | 1100
    |    6
    |   36
    | 1100
  4 |    2
  2 | 1101
(16 rows)

select cn,sum(qty) from sale group by grouping sets (cube(prc,cn));
 cn | sum  
----+------
  3 |    1
  1 |    4
  4 |    2
  3 |   24
  1 |   12
    |    2
  3 |   25
  1 |   16
    | 1144
  2 |    1
  2 | 1100
    |    6
    |   36
    | 1100
  4 |    2
  2 | 1101
(16 rows)

--end_equiv
--start_equiv
select cn,sum(distinct qty) from sale group by prc,cn
union all select null,sum(distinct qty) from sale group by prc
union all select cn,sum(distinct qty) from sale group by cn
union all select null,sum(distinct qty) from sale;
 cn | sum  
----+------
  1 |    1
  3 |    1
  4 |    1
  1 |   12
  3 |   12
    |    1
  1 |   13
  3 |   13
  2 |    1
  2 | 1100
    |    1
    |   12
    | 1100
  2 | 1101
  4 |    1
    | 1113
(16 rows)

select cn,sum(distinct qty) from sale group by cube(prc,cn);
 cn | sum  
----+------
  1 |    1
  3 |    1
  4 |    1
  1 |   12
  3 |   12
    |    1
  1 |   13
  3 |   13
  2 |    1
  2 | 1100
    |    1
    |   12
    | 1100
  2 | 1101
  4 |    1
    | 1113
(16 rows)

select cn,sum(distinct qty) from sale group by grouping sets (cube(prc,cn));
 cn | sum  
----+------
  1 |    1
  3 |    1
  4 |    1
  1 |   12
  3 |   12
    |    1
  1 |   13
  3 |   13
  2 |    1
  2 | 1100
    |    1
    |   12
    | 1100
  2 | 1101
  4 |    1
    | 1113
(16 rows)

--end_equiv
-- Ungrouped attributes in GROUPING function --
select grouping(cn,vn,pn) from sale group by cn; --error
ERROR:  column "sale"."vn" is not in GROUP BY
select grouping(cn,vn,pn) from sale group by rollup(cn); --error
ERROR:  column "sale"."vn" is not in GROUP BY
-- Using in View --
create view cube_view as select cn,vn,grouping(vn,cn) from sale group by cube(cn,vn);
\d cube_view;
    View "public.cube_view"
  Column  |  Type   | Modifiers 
----------+---------+-----------
 cn       | integer | 
 vn       | integer | 
 grouping | bigint  | 
View definition:
 SELECT sale.cn, sale.vn, grouping(sale.vn, sale.cn) AS "grouping"
   FROM sale
  GROUP BY CUBE (sale.cn, sale.vn);

create view rollup_view as select cn,vn,pn,grouping(cn,vn,pn) from sale group by rollup(cn),vn,pn;
\d rollup_view;
   View "public.rollup_view"
  Column  |  Type   | Modifiers 
----------+---------+-----------
 cn       | integer | 
 vn       | integer | 
 pn       | integer | 
 grouping | bigint  | 
View definition:
 SELECT sale.cn, sale.vn, sale.pn, grouping(sale.cn, sale.vn, sale.pn) AS "grouping"
   FROM sale
  GROUP BY sale.vn, sale.pn, ROLLUP (sale.cn);

create view gs_view as select cn,vn,grouping(vn,cn) from sale group by grouping sets ((vn), (cn), (), (cn,vn));
\d gs_view;
     View "public.gs_view"
  Column  |  Type   | Modifiers 
----------+---------+-----------
 cn       | integer | 
 vn       | integer | 
 grouping | bigint  | 
View definition:
 SELECT sale.cn, sale.vn, grouping(sale.vn, sale.cn) AS "grouping"
   FROM sale
  GROUP BY GROUPING SETS ((sale.vn), (sale.cn), (), ((sale.cn), (sale.vn)));

-- GROUP_ID function --
select pn, sum(qty), group_id() from sale group by rollup(pn);
 pn  | sum  | ?column? 
-----+------+----------
     | 1144 |        0
 100 | 1101 |        0
 200 |    2 |        0
 300 |    1 |        0
 400 |    2 |        0
 500 |   24 |        0
 600 |   12 |        0
 700 |    1 |        0
 800 |    1 |        0
(9 rows)

select pn, sum(qty), group_id() from sale group by rollup(pn),pn;
 pn  | sum  | ?column? 
-----+------+----------
 100 | 1101 |        0
 100 | 1101 |        1
 200 |    2 |        0
 200 |    2 |        1
 300 |    1 |        0
 300 |    1 |        1
 400 |    2 |        0
 400 |    2 |        1
 500 |   24 |        0
 500 |   24 |        1
 600 |   12 |        0
 600 |   12 |        1
 700 |    1 |        0
 700 |    1 |        1
 800 |    1 |        0
 800 |    1 |        1
(16 rows)

--start_equiv
select pn, sum(qty), 0 from sale group by cn,pn
union all select pn, sum(qty), 1 from sale group by cn,pn
union all select pn, sum(qty), 2 from sale group by cn,pn
union all select pn, sum(qty), 3 from sale group by cn,pn
union all select pn, sum(qty), 4 from sale group by cn,pn
union all select pn, sum(qty), 5 from sale group by cn,pn
union all select pn, sum(qty), 6 from sale group by cn,pn
union all select null, sum(qty), 0 from sale group by cn
union all select null, sum(qty), 1 from sale group by cn
union all select null, sum(qty), 2 from sale group by cn
union all select pn, sum(qty), 0 from sale group by pn
union all select null, sum(qty), 0 from sale;
 pn  | sum  | ?column? 
-----+------+----------
     |    2 |        0
     |    2 |        1
     |    2 |        2
     |   16 |        0
     |   16 |        1
     |   16 |        2
     |   25 |        0
     |   25 |        1
     |   25 |        2
     | 1101 |        0
     | 1101 |        1
     | 1101 |        2
     | 1144 |        0
 100 |    1 |        0
 100 |    1 |        1
 100 |    1 |        2
 100 |    1 |        3
 100 |    1 |        4
 100 |    1 |        5
 100 |    1 |        6
 100 | 1100 |        0
 100 | 1100 |        1
 100 | 1100 |        2
 100 | 1100 |        3
 100 | 1100 |        4
 100 | 1100 |        5
 100 | 1100 |        6
 100 | 1101 |        0
 200 |    1 |        0
 200 |    1 |        0
 200 |    1 |        1
 200 |    1 |        1
 200 |    1 |        2
 200 |    1 |        2
 200 |    1 |        3
 200 |    1 |        3
 200 |    1 |        4
 200 |    1 |        4
 200 |    1 |        5
 200 |    1 |        5
 200 |    1 |        6
 200 |    1 |        6
 200 |    2 |        0
 300 |    1 |        0
 300 |    1 |        0
 300 |    1 |        1
 300 |    1 |        2
 300 |    1 |        3
 300 |    1 |        4
 300 |    1 |        5
 300 |    1 |        6
 400 |    1 |        0
 400 |    1 |        0
 400 |    1 |        1
 400 |    1 |        1
 400 |    1 |        2
 400 |    1 |        2
 400 |    1 |        3
 400 |    1 |        3
 400 |    1 |        4
 400 |    1 |        4
 400 |    1 |        5
 400 |    1 |        5
 400 |    1 |        6
 400 |    1 |        6
 400 |    2 |        0
 500 |   12 |        0
 500 |   12 |        0
 500 |   12 |        1
 500 |   12 |        1
 500 |   12 |        2
 500 |   12 |        2
 500 |   12 |        3
 500 |   12 |        3
 500 |   12 |        4
 500 |   12 |        4
 500 |   12 |        5
 500 |   12 |        5
 500 |   12 |        6
 500 |   12 |        6
 500 |   24 |        0
 600 |   12 |        0
 600 |   12 |        0
 600 |   12 |        1
 600 |   12 |        2
 600 |   12 |        3
 600 |   12 |        4
 600 |   12 |        5
 600 |   12 |        6
 700 |    1 |        0
 700 |    1 |        0
 700 |    1 |        1
 700 |    1 |        2
 700 |    1 |        3
 700 |    1 |        4
 700 |    1 |        5
 700 |    1 |        6
 800 |    1 |        0
 800 |    1 |        0
 800 |    1 |        1
 800 |    1 |        2
 800 |    1 |        3
 800 |    1 |        4
 800 |    1 |        5
 800 |    1 |        6
(105 rows)

select pn, sum(qty), group_id() from sale group by rollup(cn,pn), cube(cn,pn);
 pn  | sum  | ?column? 
-----+------+----------
     |    2 |        0
     |    2 |        1
     |    2 |        2
     |   16 |        0
     |   16 |        1
     |   16 |        2
     |   25 |        0
     |   25 |        1
     |   25 |        2
     | 1101 |        0
     | 1101 |        1
     | 1101 |        2
     | 1144 |        0
 100 |    1 |        0
 100 |    1 |        1
 100 |    1 |        2
 100 |    1 |        3
 100 |    1 |        4
 100 |    1 |        5
 100 |    1 |        6
 100 | 1100 |        0
 100 | 1100 |        1
 100 | 1100 |        2
 100 | 1100 |        3
 100 | 1100 |        4
 100 | 1100 |        5
 100 | 1100 |        6
 100 | 1101 |        0
 200 |    1 |        0
 200 |    1 |        0
 200 |    1 |        1
 200 |    1 |        1
 200 |    1 |        2
 200 |    1 |        2
 200 |    1 |        3
 200 |    1 |        3
 200 |    1 |        4
 200 |    1 |        4
 200 |    1 |        5
 200 |    1 |        5
 200 |    1 |        6
 200 |    1 |        6
 200 |    2 |        0
 300 |    1 |        0
 300 |    1 |        0
 300 |    1 |        1
 300 |    1 |        2
 300 |    1 |        3
 300 |    1 |        4
 300 |    1 |        5
 300 |    1 |        6
 400 |    1 |        0
 400 |    1 |        0
 400 |    1 |        1
 400 |    1 |        1
 400 |    1 |        2
 400 |    1 |        2
 400 |    1 |        3
 400 |    1 |        3
 400 |    1 |        4
 400 |    1 |        4
 400 |    1 |        5
 400 |    1 |        5
 400 |    1 |        6
 400 |    1 |        6
 400 |    2 |        0
 500 |   12 |        0
 500 |   12 |        0
 500 |   12 |        1
 500 |   12 |        1
 500 |   12 |        2
 500 |   12 |        2
 500 |   12 |        3
 500 |   12 |        3
 500 |   12 |        4
 500 |   12 |        4
 500 |   12 |        5
 500 |   12 |        5
 500 |   12 |        6
 500 |   12 |        6
 500 |   24 |        0
 600 |   12 |        0
 600 |   12 |        0
 600 |   12 |        1
 600 |   12 |        2
 600 |   12 |        3
 600 |   12 |        4
 600 |   12 |        5
 600 |   12 |        6
 700 |    1 |        0
 700 |    1 |        0
 700 |    1 |        1
 700 |    1 |        2
 700 |    1 |        3
 700 |    1 |        4
 700 |    1 |        5
 700 |    1 |        6
 800 |    1 |        0
 800 |    1 |        0
 800 |    1 |        1
 800 |    1 |        2
 800 |    1 |        3
 800 |    1 |        4
 800 |    1 |        5
 800 |    1 |        6
(105 rows)

--end_equiv
-- Having clause --
--start_equiv
select cn,sum(qty) from sale group by cn,vn having vn=10;
 cn | sum 
----+-----
  1 |   1
(1 row)

select cn,sum(qty) from sale group by rollup(cn,vn) having vn=10;
 cn | sum 
----+-----
  1 |   1
(1 row)

--end_equiv
--start_equiv
select cn, vn, pn, count(dt) from sale group by cn, vn, pn having count(dt) <=2
union all
select cn, vn, null, count(dt) from sale group by cn, vn having count(dt) <=2
union all
select cn, null, null, count(dt) from sale group by cn having count(dt) <=2
union all
select null, null, null, count(dt) from sale having count(dt) <=2;    
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 |     |     1
  1 | 10 | 200 |     1
  1 | 20 |     |     1
  1 | 20 | 100 |     1
  1 | 30 |     |     2
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 50 |     |     1
  1 | 50 | 400 |     1
  2 |    |     |     2
  2 | 40 |     |     1
  2 | 40 | 100 |     1
  2 | 50 |     |     1
  2 | 50 | 400 |     1
  3 | 30 |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 40 |     |     1
  3 | 40 | 200 |     1
  4 |    |     |     2
  4 | 40 |     |     2
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
(23 rows)

select cn, vn, pn, count(dt) from sale group by rollup (cn,vn,pn) having count(dt) <=2;
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 10 |     |     1
  1 | 20 | 100 |     1
  1 | 20 |     |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 30 |     |     2
  1 | 50 | 400 |     1
  1 | 50 |     |     1
  2 | 40 | 100 |     1
  2 | 40 |     |     1
  2 | 50 | 400 |     1
  2 | 50 |     |     1
  2 |    |     |     2
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 30 |     |     2
  3 | 40 | 200 |     1
  3 | 40 |     |     1
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  4 | 40 |     |     2
  4 |    |     |     2
(23 rows)

--end_equiv
--start_equiv
select cn, vn, pn, count(distinct dt) from sale group by cn, vn, pn having count(distinct dt) <=2
union all
select cn, vn, null, count(distinct dt) from sale group by cn, vn having count(distinct dt) <=2
union all
select cn, null, null, count(distinct dt) from sale group by cn having count(distinct dt) <=2
union all
select null, null, null, count(distinct dt) from sale having count(distinct dt) <=2;    
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 |     |     1
  1 | 10 | 200 |     1
  1 | 20 |     |     1
  1 | 20 | 100 |     1
  1 | 30 |     |     2
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 50 |     |     1
  1 | 50 | 400 |     1
  2 |    |     |     2
  2 | 40 |     |     1
  2 | 40 | 100 |     1
  2 | 50 |     |     1
  2 | 50 | 400 |     1
  3 |    |     |     2
  3 | 30 |     |     1
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 40 |     |     1
  3 | 40 | 200 |     1
  4 |    |     |     1
  4 | 40 |     |     1
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
(24 rows)

select cn, vn, pn, count(distinct dt) from sale group by rollup (cn,vn,pn) having count(distinct dt) <=2;
 cn | vn | pn  | count 
----+----+-----+-------
  1 | 10 | 200 |     1
  1 | 20 | 100 |     1
  1 | 30 | 300 |     1
  1 | 30 | 500 |     1
  1 | 50 | 400 |     1
  2 | 40 | 100 |     1
  2 | 50 | 400 |     1
  3 | 30 | 500 |     1
  3 | 30 | 600 |     1
  3 | 40 | 200 |     1
  4 | 40 | 700 |     1
  4 | 40 | 800 |     1
  1 | 10 |     |     1
  1 | 20 |     |     1
  1 | 30 |     |     2
  1 | 50 |     |     1
  2 | 40 |     |     1
  2 | 50 |     |     1
  3 | 30 |     |     1
  3 | 40 |     |     1
  4 | 40 |     |     1
  2 |    |     |     2
  3 |    |     |     2
  4 |    |     |     1
(24 rows)

--end_equiv
--start_equiv
select cn,dt,count(vn),0 as grouping from sale group by cn,dt having count(vn) > 2
union all select cn,null,count(vn),1 as grouping from sale group by cn having count(vn) > 2
union all (select null,null,count(vn),3 as grouping from sale  having count(vn) > 2 limit 1)
union all select null,dt,count(vn),2 as grouping from sale group by dt having count(vn) > 2;
 cn |     dt     | count | grouping 
----+------------+-------+----------
  3 |            |     3 |        1
  1 |            |     5 |        1
    |            |    12 |        3
    | 06-01-1401 |     7 |        2
(4 rows)

select cn,dt,count(vn),grouping(cn,dt) from sale group by cube(cn,dt) having count(vn) > 2;
 cn |     dt     | count | grouping 
----+------------+-------+----------
  1 |            |     5 |        1
  3 |            |     3 |        1
    | 06-01-1401 |     7 |        2
    |            |    12 |        3
(4 rows)

select cn,dt,count(vn),grouping(cn,dt) from sale group by cube(dt,cn) having count(vn) > 2;
 cn |     dt     | count | grouping 
----+------------+-------+----------
    | 06-01-1401 |     7 |        2
  1 |            |     5 |        1
  3 |            |     3 |        1
    |            |    12 |        3
(4 rows)

--end_equiv
--start_equiv
select cn,dt,count(distinct vn),0 as grouping from sale group by cn,dt having count(distinct vn) > 2
union all select cn,null,count(distinct vn),1 as grouping from sale group by cn having count(distinct vn) > 2
union all (select null,null,count(distinct vn),3 as grouping from sale  having count(distinct vn) > 2 limit 1)
union all select null,dt,count(distinct vn),2 as grouping from sale group by dt having count(distinct vn) > 2;
 cn |     dt     | count | grouping 
----+------------+-------+----------
  1 |            |     4 |        1
    | 06-01-1401 |     3 |        2
    |            |     5 |        3
(3 rows)

select cn,dt,count(distinct vn),grouping(cn,dt) from sale group by cube(cn,dt) having count(distinct vn) > 2;
 cn |     dt     | count | grouping 
----+------------+-------+----------
    | 06-01-1401 |     3 |        2
    |            |     5 |        3
  1 |            |     4 |        1
(3 rows)

select cn,dt,count(distinct vn),grouping(cn,dt) from sale group by cube(dt,cn) having count(distinct vn) > 2;
 cn |     dt     | count | grouping 
----+------------+-------+----------
  1 |            |     4 |        1
    |            |     5 |        3
    | 06-01-1401 |     3 |        2
(3 rows)

--end_equiv
--start_equiv
select cn, null as vn, null as pn, count(dt), 1 as grouping from sale group by cn;
 cn | vn | pn | count | grouping 
----+----+----+-------+----------
  3 |    |    |     3 |        1
  1 |    |    |     5 |        1
  4 |    |    |     2 |        1
  2 |    |    |     2 |        1
(4 rows)

select cn, vn, pn, count(dt),grouping(cn,vn) from sale group by rollup (cn,vn,pn) having grouping(cn,vn)=1;
 cn | vn | pn | count | grouping 
----+----+----+-------+----------
  3 |    |    |     3 |        1
  1 |    |    |     5 |        1
  4 |    |    |     2 |        1
  2 |    |    |     2 |        1
(4 rows)

--end_equiv
--start_equiv
select cn, vn, pn, count(dt) from sale group by cn,vn,pn
union all select cn, null, null, count(dt) from sale group by cn;
 cn | vn | pn  | count 
----+----+-----+-------
  4 | 40 | 800 |     1
  3 | 30 | 600 |     1
  2 | 50 | 400 |     1
  1 | 10 | 200 |     1
  3 | 40 | 200 |     1
  1 | 20 | 100 |     1
  3 |    |     |     3
  1 |    |     |     5
  4 | 40 | 700 |     1
  1 | 50 | 400 |     1
  1 | 30 | 500 |     1
  3 | 30 | 500 |     1
  1 | 30 | 300 |     1
  2 | 40 | 100 |     1
  4 |    |     |     2
  2 |    |     |     2
(16 rows)

select cn, vn, pn, count(dt) from sale group by grouping sets ((cn,vn,pn), (cn));
 cn | vn | pn  | count 
----+----+-----+-------
  4 | 40 | 800 |     1
  3 | 30 | 600 |     1
  2 | 50 | 400 |     1
  1 | 10 | 200 |     1
  3 | 40 | 200 |     1
  1 | 20 | 100 |     1
  3 |    |     |     3
  1 |    |     |     5
  4 | 40 | 700 |     1
  1 | 50 | 400 |     1
  1 | 30 | 500 |     1
  3 | 30 | 500 |     1
  1 | 30 | 300 |     1
  2 | 40 | 100 |     1
  4 |    |     |     2
  2 |    |     |     2
(16 rows)

select cn, vn, pn, count(dt) from sale group by grouping sets ((cn,vn,pn), (cn), (cn), (cn))
having group_id()=0;
 cn | vn | pn  | count 
----+----+-----+-------
  4 | 40 | 800 |     1
  3 | 30 | 600 |     1
  2 | 50 | 400 |     1
  1 | 10 | 200 |     1
  3 | 40 | 200 |     1
  1 | 20 | 100 |     1
  3 |    |     |     3
  1 |    |     |     5
  4 | 40 | 700 |     1
  1 | 50 | 400 |     1
  1 | 30 | 500 |     1
  3 | 30 | 500 |     1
  1 | 30 | 300 |     1
  2 | 40 | 100 |     1
  4 |    |     |     2
  2 |    |     |     2
(16 rows)

--end_equiv
--start_equiv
select cn,vn,pn,count(dt),0,0 as grouping from sale group by cn,vn,pn
union all select cn,null,null,count(dt),0,3 from sale group by cn
union all select cn,null,null,count(dt),1,3 from sale group by cn
order by 6; -- order 6
 cn | vn | pn  | count | ?column? | grouping 
----+----+-----+-------+----------+----------
  4 | 40 | 800 |     1 |        0 |        0
  3 | 30 | 600 |     1 |        0 |        0
  2 | 50 | 400 |     1 |        0 |        0
  1 | 10 | 200 |     1 |        0 |        0
  3 | 40 | 200 |     1 |        0 |        0
  1 | 20 | 100 |     1 |        0 |        0
  4 | 40 | 700 |     1 |        0 |        0
  1 | 50 | 400 |     1 |        0 |        0
  1 | 30 | 500 |     1 |        0 |        0
  3 | 30 | 500 |     1 |        0 |        0
  1 | 30 | 300 |     1 |        0 |        0
  2 | 40 | 100 |     1 |        0 |        0
  4 |    |     |     2 |        0 |        3
  2 |    |     |     2 |        0 |        3
  4 |    |     |     2 |        1 |        3
  2 |    |     |     2 |        1 |        3
  3 |    |     |     3 |        0 |        3
  1 |    |     |     5 |        0 |        3
  3 |    |     |     3 |        1 |        3
  1 |    |     |     5 |        1 |        3
(20 rows)

select cn, vn, pn, count(dt),group_id(),grouping(cn,vn,pn) from sale group by grouping sets ((cn,vn,pn), (cn), (cn)) order by grouping(cn,vn,pn); -- order 6
 cn | vn | pn  | count | ?column? | grouping 
----+----+-----+-------+----------+----------
  4 | 40 | 800 |     1 |        0 |        0
  3 | 30 | 600 |     1 |        0 |        0
  2 | 50 | 400 |     1 |        0 |        0
  1 | 10 | 200 |     1 |        0 |        0
  3 | 40 | 200 |     1 |        0 |        0
  1 | 20 | 100 |     1 |        0 |        0
  4 | 40 | 700 |     1 |        0 |        0
  1 | 50 | 400 |     1 |        0 |        0
  1 | 30 | 500 |     1 |        0 |        0
  3 | 30 | 500 |     1 |        0 |        0
  1 | 30 | 300 |     1 |        0 |        0
  2 | 40 | 100 |     1 |        0 |        0
  4 |    |     |     2 |        0 |        3
  2 |    |     |     2 |        0 |        3
  4 |    |     |     2 |        1 |        3
  2 |    |     |     2 |        1 |        3
  3 |    |     |     3 |        0 |        3
  1 |    |     |     5 |        0 |        3
  3 |    |     |     3 |        1 |        3
  1 |    |     |     5 |        1 |        3
(20 rows)

--end_equiv
select a,b from (select 1 as a , 2 as b) r(a,b) group by rollup(a,b);
 a | b 
---+---
 1 | 2
 1 |  
   |  
(3 rows)

-- tests for known bugs
select dt,pn,cn,GROUP_ID(), count(prc) FROM sale GROUP BY ROLLUP((dt)),ROLLUP((cn)),ROLLUP((vn)),ROLLUP((pn),(cn));
     dt     | pn  | cn | ?column? | count 
------------+-----+----+----------+-------
            |     |    |        0 |     1
            |     |    |        0 |     1
            |     |    |        0 |     2
            |     |    |        0 |     4
            |     |    |        0 |     4
            |     |    |        0 |    12
            |     |  1 |        0 |     1
            |     |  1 |        0 |     1
            |     |  1 |        0 |     1
            |     |  1 |        0 |     2
            |     |  1 |        0 |     5
            |     |  2 |        0 |     1
            |     |  2 |        0 |     1
            |     |  2 |        0 |     2
            |     |  3 |        0 |     1
            |     |  3 |        0 |     2
            |     |  3 |        0 |     3
            |     |  4 |        0 |     2
            |     |  4 |        0 |     2
            | 100 |    |        0 |     1
            | 100 |    |        0 |     1
            | 100 |    |        0 |     2
            | 100 |  1 |        0 |     1
            | 100 |  1 |        0 |     1
            | 100 |  1 |        1 |     1
            | 100 |  1 |        1 |     1
            | 100 |  1 |        2 |     1
            | 100 |  1 |        2 |     1
            | 100 |  2 |        0 |     1
            | 100 |  2 |        0 |     1
            | 100 |  2 |        1 |     1
            | 100 |  2 |        1 |     1
            | 100 |  2 |        2 |     1
            | 100 |  2 |        2 |     1
            | 200 |    |        0 |     1
            | 200 |    |        0 |     1
            | 200 |    |        0 |     2
            | 200 |  1 |        0 |     1
            | 200 |  1 |        0 |     1
            | 200 |  1 |        1 |     1
            | 200 |  1 |        1 |     1
            | 200 |  1 |        2 |     1
            | 200 |  1 |        2 |     1
            | 200 |  3 |        0 |     1
            | 200 |  3 |        0 |     1
            | 200 |  3 |        1 |     1
            | 200 |  3 |        1 |     1
            | 200 |  3 |        2 |     1
            | 200 |  3 |        2 |     1
            | 300 |    |        0 |     1
            | 300 |    |        0 |     1
            | 300 |  1 |        0 |     1
            | 300 |  1 |        0 |     1
            | 300 |  1 |        1 |     1
            | 300 |  1 |        1 |     1
            | 300 |  1 |        2 |     1
            | 300 |  1 |        2 |     1
            | 400 |    |        0 |     2
            | 400 |    |        0 |     2
            | 400 |  1 |        0 |     1
            | 400 |  1 |        0 |     1
            | 400 |  1 |        1 |     1
            | 400 |  1 |        1 |     1
            | 400 |  1 |        2 |     1
            | 400 |  1 |        2 |     1
            | 400 |  2 |        0 |     1
            | 400 |  2 |        0 |     1
            | 400 |  2 |        1 |     1
            | 400 |  2 |        1 |     1
            | 400 |  2 |        2 |     1
            | 400 |  2 |        2 |     1
            | 500 |    |        0 |     2
            | 500 |    |        0 |     2
            | 500 |  1 |        0 |     1
            | 500 |  1 |        0 |     1
            | 500 |  1 |        1 |     1
            | 500 |  1 |        1 |     1
            | 500 |  1 |        2 |     1
            | 500 |  1 |        2 |     1
            | 500 |  3 |        0 |     1
            | 500 |  3 |        0 |     1
            | 500 |  3 |        1 |     1
            | 500 |  3 |        1 |     1
            | 500 |  3 |        2 |     1
            | 500 |  3 |        2 |     1
            | 600 |    |        0 |     1
            | 600 |    |        0 |     1
            | 600 |  3 |        0 |     1
            | 600 |  3 |        0 |     1
            | 600 |  3 |        1 |     1
            | 600 |  3 |        1 |     1
            | 600 |  3 |        2 |     1
            | 600 |  3 |        2 |     1
            | 700 |    |        0 |     1
            | 700 |    |        0 |     1
            | 700 |  4 |        0 |     1
            | 700 |  4 |        0 |     1
            | 700 |  4 |        1 |     1
            | 700 |  4 |        1 |     1
            | 700 |  4 |        2 |     1
            | 700 |  4 |        2 |     1
            | 800 |    |        0 |     1
            | 800 |    |        0 |     1
            | 800 |  4 |        0 |     1
            | 800 |  4 |        0 |     1
            | 800 |  4 |        1 |     1
            | 800 |  4 |        1 |     1
            | 800 |  4 |        2 |     1
            | 800 |  4 |        2 |     1
 01-01-1401 |     |    |        0 |     1
 01-01-1401 |     |    |        0 |     1
 01-01-1401 |     |  2 |        0 |     1
 01-01-1401 |     |  2 |        0 |     1
 01-01-1401 | 100 |    |        0 |     1
 01-01-1401 | 100 |    |        0 |     1
 01-01-1401 | 100 |  2 |        0 |     1
 01-01-1401 | 100 |  2 |        0 |     1
 01-01-1401 | 100 |  2 |        1 |     1
 01-01-1401 | 100 |  2 |        1 |     1
 01-01-1401 | 100 |  2 |        2 |     1
 01-01-1401 | 100 |  2 |        2 |     1
 03-01-1401 |     |    |        0 |     1
 03-01-1401 |     |    |        0 |     1
 03-01-1401 |     |  1 |        0 |     1
 03-01-1401 |     |  1 |        0 |     1
 03-01-1401 | 200 |    |        0 |     1
 03-01-1401 | 200 |    |        0 |     1
 03-01-1401 | 200 |  1 |        0 |     1
 03-01-1401 | 200 |  1 |        0 |     1
 03-01-1401 | 200 |  1 |        1 |     1
 03-01-1401 | 200 |  1 |        1 |     1
 03-01-1401 | 200 |  1 |        2 |     1
 03-01-1401 | 200 |  1 |        2 |     1
 04-01-1401 |     |    |        0 |     1
 04-01-1401 |     |    |        0 |     1
 04-01-1401 |     |  3 |        0 |     1
 04-01-1401 |     |  3 |        0 |     1
 04-01-1401 | 200 |    |        0 |     1
 04-01-1401 | 200 |    |        0 |     1
 04-01-1401 | 200 |  3 |        0 |     1
 04-01-1401 | 200 |  3 |        0 |     1
 04-01-1401 | 200 |  3 |        1 |     1
 04-01-1401 | 200 |  3 |        1 |     1
 04-01-1401 | 200 |  3 |        2 |     1
 04-01-1401 | 200 |  3 |        2 |     1
 05-01-1401 |     |    |        0 |     1
 05-01-1401 |     |    |        0 |     1
 05-01-1401 |     |  1 |        0 |     1
 05-01-1401 |     |  1 |        0 |     1
 05-01-1401 | 100 |    |        0 |     1
 05-01-1401 | 100 |    |        0 |     1
 05-01-1401 | 100 |  1 |        0 |     1
 05-01-1401 | 100 |  1 |        0 |     1
 05-01-1401 | 100 |  1 |        1 |     1
 05-01-1401 | 100 |  1 |        1 |     1
 05-01-1401 | 100 |  1 |        2 |     1
 05-01-1401 | 100 |  1 |        2 |     1
 05-02-1401 |     |    |        0 |     1
 05-02-1401 |     |    |        0 |     1
 05-02-1401 |     |  1 |        0 |     1
 05-02-1401 |     |  1 |        0 |     1
 05-02-1401 | 300 |    |        0 |     1
 05-02-1401 | 300 |    |        0 |     1
 05-02-1401 | 300 |  1 |        0 |     1
 05-02-1401 | 300 |  1 |        0 |     1
 05-02-1401 | 300 |  1 |        1 |     1
 05-02-1401 | 300 |  1 |        1 |     1
 05-02-1401 | 300 |  1 |        2 |     1
 05-02-1401 | 300 |  1 |        2 |     1
 06-01-1401 |     |    |        0 |     2
 06-01-1401 |     |    |        0 |     2
 06-01-1401 |     |    |        0 |     3
 06-01-1401 |     |    |        0 |     7
 06-01-1401 |     |  1 |        0 |     1
 06-01-1401 |     |  1 |        0 |     1
 06-01-1401 |     |  1 |        0 |     2
 06-01-1401 |     |  2 |        0 |     1
 06-01-1401 |     |  2 |        0 |     1
 06-01-1401 |     |  3 |        0 |     2
 06-01-1401 |     |  3 |        0 |     2
 06-01-1401 |     |  4 |        0 |     2
 06-01-1401 |     |  4 |        0 |     2
 06-01-1401 | 400 |    |        0 |     2
 06-01-1401 | 400 |    |        0 |     2
 06-01-1401 | 400 |  1 |        0 |     1
 06-01-1401 | 400 |  1 |        0 |     1
 06-01-1401 | 400 |  1 |        1 |     1
 06-01-1401 | 400 |  1 |        1 |     1
 06-01-1401 | 400 |  1 |        2 |     1
 06-01-1401 | 400 |  1 |        2 |     1
 06-01-1401 | 400 |  2 |        0 |     1
 06-01-1401 | 400 |  2 |        0 |     1
 06-01-1401 | 400 |  2 |        1 |     1
 06-01-1401 | 400 |  2 |        1 |     1
 06-01-1401 | 400 |  2 |        2 |     1
 06-01-1401 | 400 |  2 |        2 |     1
 06-01-1401 | 500 |    |        0 |     2
 06-01-1401 | 500 |    |        0 |     2
 06-01-1401 | 500 |  1 |        0 |     1
 06-01-1401 | 500 |  1 |        0 |     1
 06-01-1401 | 500 |  1 |        1 |     1
 06-01-1401 | 500 |  1 |        1 |     1
 06-01-1401 | 500 |  1 |        2 |     1
 06-01-1401 | 500 |  1 |        2 |     1
 06-01-1401 | 500 |  3 |        0 |     1
 06-01-1401 | 500 |  3 |        0 |     1
 06-01-1401 | 500 |  3 |        1 |     1
 06-01-1401 | 500 |  3 |        1 |     1
 06-01-1401 | 500 |  3 |        2 |     1
 06-01-1401 | 500 |  3 |        2 |     1
 06-01-1401 | 600 |    |        0 |     1
 06-01-1401 | 600 |    |        0 |     1
 06-01-1401 | 600 |  3 |        0 |     1
 06-01-1401 | 600 |  3 |        0 |     1
 06-01-1401 | 600 |  3 |        1 |     1
 06-01-1401 | 600 |  3 |        1 |     1
 06-01-1401 | 600 |  3 |        2 |     1
 06-01-1401 | 600 |  3 |        2 |     1
 06-01-1401 | 700 |    |        0 |     1
 06-01-1401 | 700 |    |        0 |     1
 06-01-1401 | 700 |  4 |        0 |     1
 06-01-1401 | 700 |  4 |        0 |     1
 06-01-1401 | 700 |  4 |        1 |     1
 06-01-1401 | 700 |  4 |        1 |     1
 06-01-1401 | 700 |  4 |        2 |     1
 06-01-1401 | 700 |  4 |        2 |     1
 06-01-1401 | 800 |    |        0 |     1
 06-01-1401 | 800 |    |        0 |     1
 06-01-1401 | 800 |  4 |        0 |     1
 06-01-1401 | 800 |  4 |        0 |     1
 06-01-1401 | 800 |  4 |        1 |     1
 06-01-1401 | 800 |  4 |        1 |     1
 06-01-1401 | 800 |  4 |        2 |     1
 06-01-1401 | 800 |  4 |        2 |     1
(234 rows)

--start_equiv
select vn,cn,dt,0,REGR_COUNT(prc*qty,prc*qty) FROM sale GROUP BY pn,qty,vn,cn,dt
union all select vn,cn,dt,1,REGR_COUNT(prc*qty,prc*qty) FROM sale GROUP BY pn,qty,vn,cn,dt;
 vn | cn |     dt     | ?column? | regr_count 
----+----+------------+----------+------------
 40 |  4 | 06-01-1401 |        0 |          1
 30 |  3 | 06-01-1401 |        0 |          1
 50 |  2 | 06-01-1401 |        0 |          1
 20 |  1 | 05-01-1401 |        0 |          1
 40 |  3 | 04-01-1401 |        0 |          1
 10 |  1 | 03-01-1401 |        0 |          1
 40 |  4 | 06-01-1401 |        1 |          1
 30 |  3 | 06-01-1401 |        1 |          1
 50 |  2 | 06-01-1401 |        1 |          1
 20 |  1 | 05-01-1401 |        1 |          1
 40 |  3 | 04-01-1401 |        1 |          1
 10 |  1 | 03-01-1401 |        1 |          1
 40 |  2 | 01-01-1401 |        0 |          1
 40 |  4 | 06-01-1401 |        0 |          1
 30 |  1 | 05-02-1401 |        0 |          1
 30 |  3 | 06-01-1401 |        0 |          1
 30 |  1 | 06-01-1401 |        0 |          1
 50 |  1 | 06-01-1401 |        0 |          1
 40 |  2 | 01-01-1401 |        1 |          1
 40 |  4 | 06-01-1401 |        1 |          1
 30 |  1 | 05-02-1401 |        1 |          1
 30 |  3 | 06-01-1401 |        1 |          1
 30 |  1 | 06-01-1401 |        1 |          1
 50 |  1 | 06-01-1401 |        1 |          1
(24 rows)

select vn,cn,dt,GROUP_ID(), REGR_COUNT(prc*qty,prc*qty) FROM sale GROUP BY (pn,qty),(vn),ROLLUP((qty)),cn,dt;
 vn | cn |     dt     | ?column? | regr_count 
----+----+------------+----------+------------
 40 |  4 | 06-01-1401 |        0 |          1
 30 |  3 | 06-01-1401 |        0 |          1
 50 |  2 | 06-01-1401 |        0 |          1
 20 |  1 | 05-01-1401 |        0 |          1
 40 |  3 | 04-01-1401 |        0 |          1
 10 |  1 | 03-01-1401 |        0 |          1
 40 |  4 | 06-01-1401 |        1 |          1
 30 |  3 | 06-01-1401 |        1 |          1
 50 |  2 | 06-01-1401 |        1 |          1
 20 |  1 | 05-01-1401 |        1 |          1
 40 |  3 | 04-01-1401 |        1 |          1
 10 |  1 | 03-01-1401 |        1 |          1
 40 |  2 | 01-01-1401 |        0 |          1
 40 |  4 | 06-01-1401 |        0 |          1
 30 |  1 | 05-02-1401 |        0 |          1
 30 |  3 | 06-01-1401 |        0 |          1
 30 |  1 | 06-01-1401 |        0 |          1
 50 |  1 | 06-01-1401 |        0 |          1
 40 |  2 | 01-01-1401 |        1 |          1
 40 |  4 | 06-01-1401 |        1 |          1
 30 |  1 | 05-02-1401 |        1 |          1
 30 |  3 | 06-01-1401 |        1 |          1
 30 |  1 | 06-01-1401 |        1 |          1
 50 |  1 | 06-01-1401 |        1 |          1
(24 rows)

--end_equiv
SELECT cn,pn,GROUPING(cn),GROUP_ID(), SUM(qty) FROM sale GROUP BY ROLLUP((cn,prc)),(cn,prc,dt),(pn,qty,vn) HAVING GROUP_ID() < 0 AND STDDEV_SAMP(pn) = 9.23708093366322 ORDER BY pn,cn desc;
 cn | pn | grouping | ?column? | sum 
----+----+----------+----------+-----
(0 rows)

--start_equiv
SELECT dt,GROUPING(dt), MAX(DISTINCT prc*qty) FROM sale GROUP BY (dt,vn,vn),ROLLUP((qty,cn),(vn),(vn),(prc));
     dt     | grouping |   max   
------------+----------+---------
 03-01-1401 |        0 |       0
 05-02-1401 |        0 |       0
 06-01-1401 |        0 |       1
 06-01-1401 |        0 |       0
 03-01-1401 |        0 |       0
 05-02-1401 |        0 |       0
 06-01-1401 |        0 |       0
 03-01-1401 |        0 |       0
 05-02-1401 |        0 |       0
 06-01-1401 |        0 |       0
 03-01-1401 |        0 |       0
 05-02-1401 |        0 |       0
 06-01-1401 |        0 |       0
 03-01-1401 |        0 |       0
 05-02-1401 |        0 |       0
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |       1
 06-01-1401 |        0 |       0
 01-01-1401 |        0 | 2640000
 04-01-1401 |        0 |       0
 05-01-1401 |        0 |       0
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |       0
 01-01-1401 |        0 | 2640000
 04-01-1401 |        0 |       0
 05-01-1401 |        0 |       0
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |       1
 06-01-1401 |        0 |       0
 01-01-1401 |        0 | 2640000
 04-01-1401 |        0 |       0
 05-01-1401 |        0 |       0
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |       1
 06-01-1401 |        0 |       0
 01-01-1401 |        0 | 2640000
 04-01-1401 |        0 |       0
 05-01-1401 |        0 |       0
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |       1
 06-01-1401 |        0 |       0
 01-01-1401 |        0 | 2640000
 04-01-1401 |        0 |       0
 05-01-1401 |        0 |       0
(48 rows)

select dt,0 as grouping, max(distinct prc*qty) from sale group by dt,vn,qty,cn,prc
union all select dt,0, max(distinct prc*qty) from sale group by dt,vn,qty,cn
union all select dt,0, max(distinct prc*qty) from sale group by dt,vn,qty,cn
union all select dt,0, max(distinct prc*qty) from sale group by dt,vn,qty,cn
union all select dt,0, max(distinct prc*qty) from sale group by dt,vn;
     dt     | grouping |   max   
------------+----------+---------
 03-01-1401 |        0 |       0
 05-02-1401 |        0 |       0
 06-01-1401 |        0 |       1
 06-01-1401 |        0 |       0
 03-01-1401 |        0 |       0
 05-02-1401 |        0 |       0
 06-01-1401 |        0 |       0
 03-01-1401 |        0 |       0
 05-02-1401 |        0 |       0
 06-01-1401 |        0 |       0
 03-01-1401 |        0 |       0
 05-02-1401 |        0 |       0
 06-01-1401 |        0 |       0
 03-01-1401 |        0 |       0
 05-02-1401 |        0 |       0
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |       1
 06-01-1401 |        0 |       0
 01-01-1401 |        0 | 2640000
 04-01-1401 |        0 |       0
 05-01-1401 |        0 |       0
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |       0
 01-01-1401 |        0 | 2640000
 04-01-1401 |        0 |       0
 05-01-1401 |        0 |       0
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |       1
 06-01-1401 |        0 |       0
 01-01-1401 |        0 | 2640000
 04-01-1401 |        0 |       0
 05-01-1401 |        0 |       0
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |       1
 06-01-1401 |        0 |       0
 01-01-1401 |        0 | 2640000
 04-01-1401 |        0 |       0
 05-01-1401 |        0 |       0
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |      60
 06-01-1401 |        0 |       1
 06-01-1401 |        0 |       0
 01-01-1401 |        0 | 2640000
 04-01-1401 |        0 |       0
 05-01-1401 |        0 |       0
(48 rows)

--end_equiv
--start_equiv
select sale.cn,max(distinct sale.cn) from sale,vendor where sale.vn=vendor.vn group by sale.cn,sale.vn
union all select sale.cn,max(distinct sale.cn) from sale,vendor where sale.vn=vendor.vn group by sale.cn
union all select null,max(distinct sale.cn) from sale,vendor where sale.vn=vendor.vn
union all select null,max(distinct sale.cn) from sale,vendor where sale.vn=vendor.vn group by sale.vn;
 cn | max 
----+-----
  1 |   1
  3 |   3
    |   4
  1 |   1
  1 |   1
  1 |   1
  1 |   1
  2 |   2
  2 |   2
  3 |   3
  3 |   3
  4 |   4
  2 |   2
  4 |   4
    |   1
    |   1
    |   3
    |   4
    |   2
(19 rows)

select sale.cn,max(distinct sale.cn) from sale,vendor where sale.vn=vendor.vn group by cube(sale.cn,sale.vn);
 cn | max 
----+-----
  1 |   1
  3 |   3
    |   4
  1 |   1
  1 |   1
  1 |   1
  1 |   1
  2 |   2
  2 |   2
  3 |   3
  3 |   3
  4 |   4
  2 |   2
  4 |   4
    |   1
    |   1
    |   3
    |   4
    |   2
(19 rows)

--end_equiv
--start_equiv
select cn,sum(qty) from sale group by cn;
 cn | sum  
----+------
  3 |   25
  1 |   16
  4 |    2
  2 | 1101
(4 rows)

select cn,sum(qty) from sale group by grouping sets(cn);
 cn | sum  
----+------
  3 |   25
  1 |   16
  4 |    2
  2 | 1101
(4 rows)

--end_equiv
select cn,sum(qty),grouping((cn,vn),vn) from sale group by rollup(cn,vn);
ERROR:  row type can not be used inside a grouping function.
select sum(qty),grouping(cn+pn) from sale group by cn+vn,vn;
ERROR:  expression in a grouping fuction does not appear in GROUP BY.
select sum(qty),grouping(cn+vn) from sale group by rollup(cn+vn,vn);
 sum  | grouping 
------+----------
    1 |        0
    1 |        0
   13 |        0
   24 |        0
 1100 |        0
    1 |        0
    2 |        0
    1 |        0
    1 |        0
    1 |        0
    1 |        0
   13 |        0
   24 |        0
 1100 |        0
    1 |        0
    2 |        0
    1 |        0
    1 |        0
 1144 |        1
(19 rows)

select * from sale where exists (select cn, sum(qty) from sale group by rollup(cn,vn) having sum(qty)=10000000);
 cn | vn | pn | dt | qty | prc 
----+----+----+----+-----+-----
(0 rows)

create sequence newseq start 1;
create view v7 as select nextval('newseq');
select sum(nextval) from v7 group by rollup(nextval);
 sum 
-----
   1
   1
(2 rows)

-- MPP-1858
SELECT sale.vn,sale.qty,sale.cn,sale.vn,sale.prc,MIN(floor(sale.qty))
FROM sale
GROUP BY CUBE((sale.cn,sale.prc),(sale.vn),(sale.cn,sale.cn),(sale.vn,sale.qty)),
ROLLUP((sale.cn,sale.pn),(sale.prc,sale.qty),(sale.cn));
 vn | qty  | cn | vn | prc  | min  
----+------+----+----+------+------
 20 |    1 |  1 | 20 |      |    1
 20 |    1 |  1 | 20 |      |    1
 20 |    1 |  1 | 20 |      |    1
 20 |    1 |  1 | 20 |      |    1
 20 |      |  1 | 20 |      |    1
 20 |      |  1 | 20 |      |    1
 10 |    1 |  1 | 10 |      |    1
 10 |    1 |  1 | 10 |      |    1
 10 |    1 |  1 | 10 |      |    1
 10 |    1 |  1 | 10 |      |    1
 10 |      |  1 | 10 |      |    1
 10 |      |  1 | 10 |      |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
    |      |  1 |    |      |    1
    |      |  1 |    |      |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
    |      |  1 |    |      |    1
    |      |  1 |    |      |    1
 30 |   12 |  1 | 30 |      |   12
 30 |   12 |  1 | 30 |      |   12
 30 |   12 |  1 | 30 |      |   12
 30 |   12 |  1 | 30 |      |   12
    |      |  1 |    |      |   12
    |      |  1 |    |      |   12
 40 | 1100 |  2 | 40 |      | 1100
 40 | 1100 |  2 | 40 |      | 1100
 40 | 1100 |  2 | 40 |      | 1100
 40 | 1100 |  2 | 40 |      | 1100
    |      |  2 |    |      | 1100
    |      |  2 |    |      | 1100
 50 |    1 |  2 | 50 |      |    1
 50 |    1 |  2 | 50 |      |    1
 50 |    1 |  2 | 50 |      |    1
 50 |    1 |  2 | 50 |      |    1
 50 |      |  2 | 50 |      |    1
 50 |      |  2 | 50 |      |    1
    |      |  2 |    |      |    1
 40 |    1 |  3 | 40 |      |    1
 40 |    1 |  3 | 40 |      |    1
 40 |    1 |  3 | 40 |      |    1
 40 |    1 |  3 | 40 |      |    1
 40 |      |  3 | 40 |      |    1
 40 |      |  3 | 40 |      |    1
 30 |   12 |  3 | 30 |      |   12
 30 |   12 |  3 | 30 |      |   12
 30 |   12 |  3 | 30 |      |   12
 30 |   12 |  3 | 30 |      |   12
    |      |  3 |    |      |   12
    |      |  3 |    |      |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |      |  3 | 30 |      |   12
 30 |      |  3 | 30 |      |   12
    |      |  4 |    |      |    1
    |      |  4 |    |      |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |      |    1
 40 |    1 |  4 | 40 |      |    1
 40 |    1 |  4 | 40 |      |    1
 40 |    1 |  4 | 40 |      |    1
 40 |      |  4 | 40 |      |    1
 40 |      |  4 | 40 |      |    1
    |      |  4 |    |      |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |      |  1 |    |    0 |    1
    |      |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |      |  1 |    |    0 |    1
    |      |  1 |    |    0 |    1
    |      |  1 |    |    0 |    1
    |      |  1 |    |    0 |    1
    |   12 |  1 |    |    5 |   12
    |   12 |  1 |    |    5 |   12
    |   12 |  1 |    |    5 |   12
    |   12 |  1 |    |    5 |   12
    |   12 |  1 |    |    5 |   12
    |   12 |  1 |    |    5 |   12
    |   12 |  1 |    |    5 |   12
    |   12 |  1 |    |    5 |   12
    |      |  1 |    |    5 |   12
    |      |  1 |    |    5 |   12
    |    1 |  2 |    |    0 |    1
    |    1 |  2 |    |    0 |    1
    |    1 |  2 |    |    0 |    1
    |    1 |  2 |    |    0 |    1
    |    1 |  2 |    |    0 |    1
    |    1 |  2 |    |    0 |    1
    |    1 |  2 |    |    0 |    1
    |    1 |  2 |    |    0 |    1
    |      |  2 |    |    0 |    1
    |      |  2 |    |    0 |    1
    | 1100 |  2 |    | 2400 | 1100
    | 1100 |  2 |    | 2400 | 1100
    | 1100 |  2 |    | 2400 | 1100
    | 1100 |  2 |    | 2400 | 1100
    | 1100 |  2 |    | 2400 | 1100
    | 1100 |  2 |    | 2400 | 1100
    | 1100 |  2 |    | 2400 | 1100
    | 1100 |  2 |    | 2400 | 1100
    |    1 |  3 |    |    0 |    1
    |    1 |  3 |    |    0 |    1
    |    1 |  3 |    |    0 |    1
    |    1 |  3 |    |    0 |    1
    |    1 |  3 |    |    0 |    1
    |    1 |  3 |    |    0 |    1
    |    1 |  3 |    |    0 |    1
    |    1 |  3 |    |    0 |    1
    |      |  3 |    |    0 |    1
    |      |  3 |    |    0 |    1
    |      |  3 |    |    0 |    1
    |      |  3 |    |    0 |    1
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |      |  3 |    |    5 |   12
    |      |  3 |    |    5 |   12
    |      |  3 |    |    5 |   12
    |      |  3 |    |    5 |   12
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |      |  4 |    |    1 |    1
    |      |  4 |    |    1 |    1
    |      |  4 |    |    1 |    1
    |      |  4 |    |    1 |    1
 10 |      |  1 | 10 |      |    1
 10 |      |    | 10 |      |    1
 20 |      |  1 | 20 |      |    1
 20 |      |    | 20 |      |    1
 30 |      |  1 | 30 |    0 |    1
 30 |      |  1 | 30 |    0 |    1
 30 |      |  1 | 30 |    5 |   12
 30 |      |  1 | 30 |    5 |   12
 30 |      |  1 | 30 |      |    1
 30 |      |  3 | 30 |    5 |   12
 30 |      |  3 | 30 |    5 |   12
 30 |      |  3 | 30 |      |   12
 30 |      |    | 30 |      |    1
 40 |      |  2 | 40 | 2400 | 1100
 40 |      |  2 | 40 | 2400 | 1100
 40 |      |  2 | 40 | 2400 | 1100
 40 |      |  2 | 40 | 2400 | 1100
 40 |      |  3 | 40 |      |    1
 40 |      |  4 | 40 |    1 |    1
 40 |      |  4 | 40 |    1 |    1
 40 |      |    | 40 |      |    1
 50 |      |  1 | 50 |    0 |    1
 50 |      |  1 | 50 |    0 |    1
 50 |      |  1 | 50 |      |    1
 50 |      |  2 | 50 |    0 |    1
 50 |      |  2 | 50 |    0 |    1
 50 |      |    | 50 |      |    1
 10 |    1 |  1 | 10 |      |    1
 10 |    1 |  1 | 10 |      |    1
 10 |    1 |    | 10 |      |    1
 10 |    1 |    | 10 |      |    1
 20 |    1 |  1 | 20 |      |    1
 20 |    1 |  1 | 20 |      |    1
 20 |    1 |    | 20 |      |    1
 20 |    1 |    | 20 |      |    1
 30 |    1 |  1 | 30 |      |    1
 30 |    1 |  1 | 30 |      |    1
 30 |    1 |    | 30 |      |    1
 30 |    1 |    | 30 |      |    1
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 40 |    1 |  3 | 40 |      |    1
 40 |    1 |  3 | 40 |      |    1
 40 |    1 |    | 40 |      |    1
 40 |    1 |    | 40 |      |    1
 40 | 1100 |  2 | 40 |      | 1100
 40 | 1100 |  2 | 40 |      | 1100
 50 |    1 |  1 | 50 |      |    1
 50 |    1 |  1 | 50 |      |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |    | 50 |      |    1
 50 |    1 |    | 50 |      |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
    |      |  1 |    |      |    1
    |      |  1 |    |      |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
    |      |  1 |    |      |    1
    |      |  1 |    |      |    1
 30 |    1 |  1 | 30 |      |    1
 30 |    1 |  1 | 30 |      |    1
 30 |    1 |  1 | 30 |      |    1
 30 |    1 |  1 | 30 |      |    1
 30 |      |  1 | 30 |      |    1
 30 |      |  1 | 30 |      |    1
 50 |    1 |  1 | 50 |      |    1
 50 |    1 |  1 | 50 |      |    1
 50 |    1 |  1 | 50 |      |    1
 50 |    1 |  1 | 50 |      |    1
 50 |      |  1 | 50 |      |    1
 50 |      |  1 | 50 |      |    1
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |   12 |  1 | 30 |    5 |   12
 30 |      |  1 | 30 |      |   12
 30 |      |  1 | 30 |      |   12
    |      |  1 |    |      |    1
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 |      |  2 | 40 |      | 1100
 40 |      |  2 | 40 |      | 1100
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
 50 |    1 |  2 | 50 |    0 |    1
    |      |  2 |    |      |    1
    |      |  2 |    |      |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
    |      |  3 |    |      |    1
    |      |  3 |    |      |    1
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |   12 |  3 | 30 |    5 |   12
 30 |      |  3 | 30 |      |   12
 30 |      |  3 | 30 |      |   12
 30 |   12 |  3 | 30 |      |   12
 30 |   12 |  3 | 30 |      |   12
 30 |   12 |  3 | 30 |      |   12
 30 |   12 |  3 | 30 |      |   12
    |      |  3 |    |      |   12
    |      |  3 |    |      |   12
    |      |  3 |    |      |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |      |    1
 40 |    1 |  4 | 40 |      |    1
 40 |    1 |  4 | 40 |      |    1
 40 |    1 |  4 | 40 |      |    1
 40 |      |  4 | 40 |      |    1
 40 |      |  4 | 40 |      |    1
    |      |  4 |    |      |    1
    |      |  4 |    |      |    1
    |      |    |    |      |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |      |  1 |    |    0 |    1
    |      |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |    1 |  1 |    |    0 |    1
    |      |  1 |    |    0 |    1
    |      |  1 |    |    0 |    1
    |      |  1 |    |    5 |   12
    |      |  1 |    |    5 |   12
    |      |  2 |    |    0 |    1
    |      |  2 |    |    0 |    1
    |      |  2 |    | 2400 | 1100
    |      |  2 |    | 2400 | 1100
    |      |  2 |    | 2400 | 1100
    |      |  2 |    | 2400 | 1100
    |      |  3 |    |    5 |   12
    |      |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |   12 |  3 |    |    5 |   12
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |    1 |  4 |    |    1 |    1
    |      |  4 |    |    1 |    1
    |      |  4 |    |    1 |    1
 10 |      |  1 | 10 |    0 |    1
 10 |      |  1 | 10 |    0 |    1
 10 |      |  1 | 10 |    0 |    1
 10 |      |  1 | 10 |    0 |    1
 20 |      |  1 | 20 |    0 |    1
 20 |      |  1 | 20 |    0 |    1
 20 |      |  1 | 20 |    0 |    1
 20 |      |  1 | 20 |    0 |    1
 30 |      |  1 | 30 |    0 |    1
 30 |      |  1 | 30 |    0 |    1
 30 |      |  1 | 30 |    5 |   12
 30 |      |  1 | 30 |    5 |   12
 30 |      |  3 | 30 |    5 |   12
 30 |      |  3 | 30 |    5 |   12
 30 |      |  3 | 30 |    5 |   12
 30 |      |  3 | 30 |    5 |   12
 40 |      |  2 | 40 |      | 1100
 40 |      |  3 | 40 |    0 |    1
 40 |      |  3 | 40 |    0 |    1
 40 |      |  3 | 40 |    0 |    1
 40 |      |  3 | 40 |    0 |    1
 40 |      |  4 | 40 |    1 |    1
 40 |      |  4 | 40 |    1 |    1
 40 |      |  4 | 40 |    1 |    1
 40 |      |  4 | 40 |    1 |    1
 40 |      |  4 | 40 |      |    1
 50 |      |  1 | 50 |    0 |    1
 50 |      |  1 | 50 |    0 |    1
 50 |      |  2 | 50 |    0 |    1
 50 |      |  2 | 50 |    0 |    1
 50 |      |  2 | 50 |      |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 10 |    1 |  1 | 10 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 20 |    1 |  1 | 20 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |    1 |  1 | 30 |    0 |    1
 30 |   12 |  1 | 30 |      |   12
 30 |   12 |  1 | 30 |      |   12
 30 |   12 |  3 | 30 |      |   12
 30 |   12 |  3 | 30 |      |   12
 30 |   12 |    | 30 |      |   12
 30 |   12 |    | 30 |      |   12
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  3 | 40 |    0 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |    1 |    1
 40 |    1 |  4 | 40 |      |    1
 40 |    1 |  4 | 40 |      |    1
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |  2 | 40 | 2400 | 1100
 40 | 1100 |    | 40 |      | 1100
 40 | 1100 |    | 40 |      | 1100
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  1 | 50 |    0 |    1
 50 |    1 |  2 | 50 |      |    1
 50 |    1 |  2 | 50 |      |    1
(703 rows)

select pn,prc,cn,vn,sum(qty) from sale group by grouping sets (rollup(pn,prc), rollup(cn,vn));
 pn  | prc  | cn | vn | sum  
-----+------+----+----+------
     |      |  1 | 30 |   13
     |      |  1 | 50 |    1
     |      |  1 | 10 |    1
     |      |  1 | 20 |    1
     |      |  1 |    |   16
     |      |  3 | 30 |   24
     |      |  3 | 40 |    1
     |      |  3 |    |   25
     |      |    |    | 1144
     |      |    |    | 1144
 100 |    0 |    |    |    1
 100 | 2400 |    |    | 1100
 200 |    0 |    |    |    2
 600 |    5 |    |    |   12
 800 |    1 |    |    |    1
 300 |      |    |    |    1
 400 |      |    |    |    2
 500 |      |    |    |   24
 800 |      |    |    |    1
     |      |  2 | 40 | 1100
     |      |  2 | 50 |    1
     |      |  2 |    | 1101
     |      |  4 | 40 |    2
     |      |  4 |    |    2
 300 |    0 |    |    |    1
 400 |    0 |    |    |    2
 500 |    5 |    |    |   24
 700 |    1 |    |    |    1
 100 |      |    |    | 1101
 200 |      |    |    |    2
 600 |      |    |    |   12
 700 |      |    |    |    1
(32 rows)

SELECT sale.vn,sale.pn,GROUP_ID(),COUNT(floor(sale.vn+sale.cn)) FROM sale
GROUP BY (),GROUPING SETS(CUBE((sale.qty,sale.qty,sale.qty),(sale.pn,sale.pn),(sale.cn,sale.pn,sale.prc),(sale.cn,sale.vn,sale.vn)),
CUBE((sale.cn,sale.qty),(sale.vn,sale.prc,sale.qty),(sale.vn),(sale.vn,sale.dt),(sale.pn),(sale.qty,sale.pn)),CUBE((sale.qty,sale.dt))) 
ORDER BY sale.vn asc,sale.pn desc,sale.vn asc,sale.vn asc; --mvd 1,2->3
 vn | pn  | ?column? | count 
----+-----+----------+-------
 10 |     |        0 |     1
 10 |     |        1 |     1
 10 |     |        0 |     1
 10 |     |        1 |     1
 10 |     |        0 |     1
 10 |     |        1 |     1
 10 |     |        0 |     1
 10 |     |        1 |     1
 10 |     |        1 |     1
 10 |     |        0 |     1
 10 |     |        0 |     1
 10 |     |        1 |     1
 10 |     |        0 |     1
 10 |     |        1 |     1
 10 |     |        0 |     1
 10 |     |        0 |     1
 10 | 200 |        3 |     1
 10 | 200 |        4 |     1
 10 | 200 |        5 |     1
 10 | 200 |        0 |     1
 10 | 200 |        1 |     1
 10 | 200 |        0 |     1
 10 | 200 |        5 |     1
 10 | 200 |        1 |     1
 10 | 200 |        2 |     1
 10 | 200 |        3 |     1
 10 | 200 |        5 |     1
 10 | 200 |        6 |     1
 10 | 200 |        1 |     1
 10 | 200 |        0 |     1
 10 | 200 |        7 |     1
 10 | 200 |        1 |     1
 10 | 200 |        4 |     1
 10 | 200 |        3 |     1
 10 | 200 |        2 |     1
 10 | 200 |        0 |     1
 10 | 200 |        0 |     1
 10 | 200 |        0 |     1
 10 | 200 |        1 |     1
 10 | 200 |        2 |     1
 10 | 200 |        3 |     1
 10 | 200 |        4 |     1
 10 | 200 |        1 |     1
 10 | 200 |        2 |     1
 10 | 200 |        2 |     1
 10 | 200 |        2 |     1
 10 | 200 |        0 |     1
 10 | 200 |        4 |     1
 10 | 200 |        1 |     1
 10 | 200 |        0 |     1
 10 | 200 |        1 |     1
 10 | 200 |        3 |     1
 10 | 200 |        4 |     1
 10 | 200 |        5 |     1
 10 | 200 |        0 |     1
 10 | 200 |        1 |     1
 10 | 200 |        0 |     1
 10 | 200 |        2 |     1
 10 | 200 |        3 |     1
 10 | 200 |        5 |     1
 10 | 200 |        0 |     1
 10 | 200 |        0 |     1
 10 | 200 |        1 |     1
 10 | 200 |        3 |     1
 20 |     |        1 |     1
 20 |     |        1 |     1
 20 |     |        0 |     1
 20 |     |        0 |     1
 20 |     |        1 |     1
 20 |     |        0 |     1
 20 |     |        0 |     1
 20 |     |        1 |     1
 20 |     |        0 |     1
 20 |     |        0 |     1
 20 |     |        0 |     1
 20 |     |        1 |     1
 20 |     |        0 |     1
 20 |     |        1 |     1
 20 |     |        1 |     1
 20 |     |        0 |     1
 20 | 100 |        4 |     1
 20 | 100 |        3 |     1
 20 | 100 |        2 |     1
 20 | 100 |        1 |     1
 20 | 100 |        0 |     1
 20 | 100 |        4 |     1
 20 | 100 |        3 |     1
 20 | 100 |        1 |     1
 20 | 100 |        2 |     1
 20 | 100 |        1 |     1
 20 | 100 |        0 |     1
 20 | 100 |        4 |     1
 20 | 100 |        0 |     1
 20 | 100 |        5 |     1
 20 | 100 |        6 |     1
 20 | 100 |        3 |     1
 20 | 100 |        3 |     1
 20 | 100 |        1 |     1
 20 | 100 |        0 |     1
 20 | 100 |        4 |     1
 20 | 100 |        5 |     1
 20 | 100 |        2 |     1
 20 | 100 |        7 |     1
 20 | 100 |        0 |     1
 20 | 100 |        1 |     1
 20 | 100 |        5 |     1
 20 | 100 |        2 |     1
 20 | 100 |        5 |     1
 20 | 100 |        0 |     1
 20 | 100 |        1 |     1
 20 | 100 |        1 |     1
 20 | 100 |        1 |     1
 20 | 100 |        0 |     1
 20 | 100 |        2 |     1
 20 | 100 |        3 |     1
 20 | 100 |        4 |     1
 20 | 100 |        2 |     1
 20 | 100 |        3 |     1
 20 | 100 |        2 |     1
 20 | 100 |        1 |     1
 20 | 100 |        0 |     1
 20 | 100 |        1 |     1
 20 | 100 |        0 |     1
 20 | 100 |        0 |     1
 20 | 100 |        5 |     1
 20 | 100 |        3 |     1
 20 | 100 |        0 |     1
 20 | 100 |        0 |     1
 30 |     |        1 |     1
 30 |     |        1 |     1
 30 |     |        0 |     1
 30 |     |        1 |     2
 30 |     |        0 |     2
 30 |     |        1 |     3
 30 |     |        0 |     3
 30 |     |        0 |     1
 30 |     |        0 |     1
 30 |     |        1 |     1
 30 |     |        0 |     1
 30 |     |        1 |     1
 30 |     |        1 |     1
 30 |     |        0 |     1
 30 |     |        1 |     2
 30 |     |        0 |     2
 30 |     |        1 |     1
 30 |     |        1 |     3
 30 |     |        0 |     3
 30 |     |        0 |     1
 30 |     |        1 |     2
 30 |     |        0 |     2
 30 |     |        1 |     1
 30 |     |        0 |     1
 30 |     |        0 |     1
 30 |     |        0 |     1
 30 |     |        1 |     1
 30 |     |        0 |     1
 30 |     |        1 |     1
 30 |     |        0 |     2
 30 |     |        1 |     1
 30 |     |        0 |     2
 30 |     |        0 |     3
 30 |     |        1 |     2
 30 |     |        0 |     1
 30 |     |        0 |     4
 30 |     |        1 |     1
 30 |     |        0 |     2
 30 |     |        1 |     3
 30 | 600 |        1 |     1
 30 | 600 |        0 |     1
 30 | 600 |        2 |     1
 30 | 600 |        3 |     1
 30 | 600 |        5 |     1
 30 | 600 |        4 |     1
 30 | 600 |        3 |     1
 30 | 600 |        2 |     1
 30 | 600 |        1 |     1
 30 | 600 |        0 |     1
 30 | 600 |        1 |     1
 30 | 600 |        5 |     1
 30 | 600 |        4 |     1
 30 | 600 |        3 |     1
 30 | 600 |        2 |     1
 30 | 600 |        1 |     1
 30 | 600 |        0 |     1
 30 | 600 |        1 |     1
 30 | 600 |        0 |     1
 30 | 600 |        0 |     1
 30 | 600 |        0 |     1
 30 | 600 |        1 |     1
 30 | 600 |        2 |     1
 30 | 600 |        4 |     1
 30 | 600 |        5 |     1
 30 | 600 |        6 |     1
 30 | 600 |        7 |     1
 30 | 600 |        0 |     1
 30 | 600 |        1 |     1
 30 | 600 |        3 |     1
 30 | 600 |        2 |     1
 30 | 600 |        1 |     1
 30 | 600 |        0 |     1
 30 | 600 |        2 |     1
 30 | 600 |        3 |     1
 30 | 600 |        4 |     1
 30 | 600 |        5 |     1
 30 | 600 |        0 |     1
 30 | 600 |        0 |     1
 30 | 600 |        5 |     1
 30 | 600 |        4 |     1
 30 | 600 |        3 |     1
 30 | 600 |        2 |     1
 30 | 600 |        1 |     1
 30 | 600 |        0 |     1
 30 | 600 |        0 |     1
 30 | 600 |        1 |     1
 30 | 600 |        3 |     1
 30 | 500 |        1 |     1
 30 | 500 |        4 |     2
 30 | 500 |        5 |     2
 30 | 500 |        0 |     1
 30 | 500 |        0 |     1
 30 | 500 |        1 |     1
 30 | 500 |        0 |     1
 30 | 500 |        1 |     1
 30 | 500 |        2 |     1
 30 | 500 |        3 |     1
 30 | 500 |        4 |     1
 30 | 500 |        5 |     1
 30 | 500 |        0 |     1
 30 | 500 |        1 |     1
 30 | 500 |        2 |     1
 30 | 500 |        3 |     1
 30 | 500 |        4 |     1
 30 | 500 |        1 |     1
 30 | 500 |        5 |     1
 30 | 500 |        3 |     1
 30 | 500 |        2 |     1
 30 | 500 |        1 |     1
 30 | 500 |        0 |     1
 30 | 500 |        3 |     1
 30 | 500 |        2 |     1
 30 | 500 |        0 |     1
 30 | 500 |        1 |     2
 30 | 500 |        0 |     2
 30 | 500 |        1 |     2
 30 | 500 |        0 |     2
 30 | 500 |        2 |     2
 30 | 500 |        3 |     2
 30 | 500 |        0 |     2
 30 | 500 |        1 |     2
 30 | 500 |        6 |     1
 30 | 500 |        4 |     1
 30 | 500 |        3 |     1
 30 | 500 |        0 |     2
 30 | 500 |        1 |     2
 30 | 500 |        2 |     2
 30 | 500 |        3 |     2
 30 | 500 |        0 |     2
 30 | 500 |        4 |     1
 30 | 500 |        3 |     1
 30 | 500 |        0 |     2
 30 | 500 |        1 |     2
 30 | 500 |        2 |     2
 30 | 500 |        3 |     2
 30 | 500 |        4 |     2
 30 | 500 |        5 |     2
 30 | 500 |        0 |     1
 30 | 500 |        1 |     1
 30 | 500 |        2 |     1
 30 | 500 |        3 |     1
 30 | 500 |        4 |     1
 30 | 500 |        5 |     1
 30 | 500 |        0 |     1
 30 | 500 |        1 |     1
 30 | 500 |        5 |     1
 30 | 500 |        7 |     1
 30 | 500 |        5 |     1
 30 | 500 |        2 |     1
 30 | 500 |        1 |     1
 30 | 500 |        0 |     1
 30 | 500 |        2 |     1
 30 | 500 |        0 |     1
 30 | 500 |        7 |     1
 30 | 500 |        6 |     1
 30 | 500 |        5 |     1
 30 | 500 |        4 |     1
 30 | 500 |        3 |     1
 30 | 500 |        2 |     1
 30 | 500 |        1 |     1
 30 | 500 |        0 |     1
 30 | 500 |        0 |     1
 30 | 300 |        0 |     1
 30 | 300 |        1 |     1
 30 | 300 |        2 |     1
 30 | 300 |        3 |     1
 30 | 300 |        4 |     1
 30 | 300 |        5 |     1
 30 | 300 |        1 |     1
 30 | 300 |        3 |     1
 30 | 300 |        0 |     1
 30 | 300 |        1 |     1
 30 | 300 |        2 |     1
 30 | 300 |        1 |     1
 30 | 300 |        5 |     1
 30 | 300 |        0 |     1
 30 | 300 |        2 |     1
 30 | 300 |        3 |     1
 30 | 300 |        4 |     1
 30 | 300 |        0 |     1
 30 | 300 |        0 |     1
 30 | 300 |        0 |     1
 30 | 300 |        1 |     1
 30 | 300 |        5 |     1
 30 | 300 |        4 |     1
 30 | 300 |        3 |     1
 30 | 300 |        2 |     1
 30 | 300 |        1 |     1
 30 | 300 |        0 |     1
 30 | 300 |        4 |     1
 30 | 300 |        1 |     1
 30 | 300 |        0 |     1
 30 | 300 |        0 |     1
 30 | 300 |        1 |     1
 30 | 300 |        5 |     1
 30 | 300 |        7 |     1
 30 | 300 |        4 |     1
 30 | 300 |        5 |     1
 30 | 300 |        0 |     1
 30 | 300 |        1 |     1
 30 | 300 |        0 |     1
 30 | 300 |        1 |     1
 30 | 300 |        2 |     1
 30 | 300 |        3 |     1
 30 | 300 |        3 |     1
 30 | 300 |        2 |     1
 30 | 300 |        6 |     1
 30 | 300 |        2 |     1
 30 | 300 |        0 |     1
 30 | 300 |        3 |     1
 40 |     |        1 |     1
 40 |     |        0 |     1
 40 |     |        1 |     2
 40 |     |        0 |     2
 40 |     |        0 |     1
 40 |     |        1 |     2
 40 |     |        0 |     2
 40 |     |        1 |     1
 40 |     |        0 |     1
 40 |     |        1 |     1
 40 |     |        0 |     2
 40 |     |        1 |     1
 40 |     |        0 |     2
 40 |     |        1 |     2
 40 |     |        0 |     1
 40 |     |        0 |     1
 40 |     |        1 |     2
 40 |     |        0 |     1
 40 |     |        1 |     1
 40 |     |        0 |     2
 40 |     |        1 |     1
 40 |     |        0 |     1
 40 |     |        1 |     2
 40 |     |        0 |     1
 40 |     |        1 |     1
 40 |     |        0 |     2
 40 |     |        1 |     2
 40 |     |        0 |     2
 40 |     |        1 |     1
 40 |     |        0 |     1
 40 |     |        1 |     1
 40 |     |        0 |     1
 40 |     |        1 |     1
 40 |     |        0 |     1
 40 |     |        0 |     4
 40 |     |        1 |     1
 40 |     |        0 |     1
 40 |     |        1 |     1
 40 |     |        0 |     1
 40 |     |        1 |     2
 40 |     |        0 |     2
 40 |     |        1 |     1
 40 |     |        0 |     1
 40 |     |        1 |     1
 40 |     |        0 |     1
 40 |     |        0 |     1
 40 | 800 |        1 |     1
 40 | 800 |        2 |     1
 40 | 800 |        0 |     1
 40 | 800 |        0 |     1
 40 | 800 |        0 |     1
 40 | 800 |        3 |     1
 40 | 800 |        4 |     1
 40 | 800 |        5 |     1
 40 | 800 |        4 |     1
 40 | 800 |        5 |     1
 40 | 800 |        4 |     1
 40 | 800 |        3 |     1
 40 | 800 |        2 |     1
 40 | 800 |        3 |     1
 40 | 800 |        2 |     1
 40 | 800 |        1 |     1
 40 | 800 |        0 |     1
 40 | 800 |        1 |     1
 40 | 800 |        1 |     1
 40 | 800 |        5 |     1
 40 | 800 |        0 |     1
 40 | 800 |        0 |     1
 40 | 800 |        5 |     1
 40 | 800 |        4 |     1
 40 | 800 |        3 |     1
 40 | 800 |        2 |     1
 40 | 800 |        1 |     1
 40 | 800 |        0 |     1
 40 | 800 |        3 |     1
 40 | 800 |        2 |     1
 40 | 800 |        1 |     1
 40 | 800 |        0 |     1
 40 | 800 |        1 |     1
 40 | 800 |        0 |     1
 40 | 800 |        7 |     1
 40 | 800 |        6 |     1
 40 | 800 |        5 |     1
 40 | 800 |        4 |     1
 40 | 800 |        3 |     1
 40 | 800 |        2 |     1
 40 | 800 |        1 |     1
 40 | 800 |        1 |     1
 40 | 800 |        0 |     1
 40 | 800 |        0 |     1
 40 | 800 |        3 |     1
 40 | 800 |        2 |     1
 40 | 800 |        1 |     1
 40 | 800 |        0 |     1
 40 | 700 |        4 |     1
 40 | 700 |        0 |     1
 40 | 700 |        4 |     1
 40 | 700 |        3 |     1
 40 | 700 |        2 |     1
 40 | 700 |        1 |     1
 40 | 700 |        1 |     1
 40 | 700 |        0 |     1
 40 | 700 |        5 |     1
 40 | 700 |        4 |     1
 40 | 700 |        3 |     1
 40 | 700 |        2 |     1
 40 | 700 |        1 |     1
 40 | 700 |        0 |     1
 40 | 700 |        5 |     1
 40 | 700 |        0 |     1
 40 | 700 |        0 |     1
 40 | 700 |        1 |     1
 40 | 700 |        2 |     1
 40 | 700 |        3 |     1
 40 | 700 |        5 |     1
 40 | 700 |        0 |     1
 40 | 700 |        1 |     1
 40 | 700 |        0 |     1
 40 | 700 |        1 |     1
 40 | 700 |        2 |     1
 40 | 700 |        3 |     1
 40 | 700 |        0 |     1
 40 | 700 |        1 |     1
 40 | 700 |        2 |     1
 40 | 700 |        3 |     1
 40 | 700 |        4 |     1
 40 | 700 |        5 |     1
 40 | 700 |        0 |     1
 40 | 700 |        0 |     1
 40 | 700 |        1 |     1
 40 | 700 |        5 |     1
 40 | 700 |        3 |     1
 40 | 700 |        2 |     1
 40 | 700 |        1 |     1
 40 | 700 |        0 |     1
 40 | 700 |        4 |     1
 40 | 700 |        0 |     1
 40 | 700 |        1 |     1
 40 | 700 |        2 |     1
 40 | 700 |        3 |     1
 40 | 700 |        7 |     1
 40 | 700 |        6 |     1
 40 | 200 |        4 |     1
 40 | 200 |        5 |     1
 40 | 200 |        0 |     1
 40 | 200 |        1 |     1
 40 | 200 |        2 |     1
 40 | 200 |        3 |     1
 40 | 200 |        4 |     1
 40 | 200 |        3 |     1
 40 | 200 |        2 |     1
 40 | 200 |        1 |     1
 40 | 200 |        0 |     1
 40 | 200 |        5 |     1
 40 | 200 |        4 |     1
 40 | 200 |        5 |     1
 40 | 200 |        6 |     1
 40 | 200 |        5 |     1
 40 | 200 |        4 |     1
 40 | 200 |        0 |     1
 40 | 200 |        0 |     1
 40 | 200 |        1 |     1
 40 | 200 |        2 |     1
 40 | 200 |        1 |     1
 40 | 200 |        3 |     1
 40 | 200 |        7 |     1
 40 | 200 |        2 |     1
 40 | 200 |        0 |     1
 40 | 200 |        1 |     1
 40 | 200 |        3 |     1
 40 | 200 |        1 |     1
 40 | 200 |        3 |     1
 40 | 200 |        2 |     1
 40 | 200 |        1 |     1
 40 | 200 |        0 |     1
 40 | 200 |        0 |     1
 40 | 200 |        1 |     1
 40 | 200 |        0 |     1
 40 | 200 |        0 |     1
 40 | 200 |        0 |     1
 40 | 200 |        1 |     1
 40 | 200 |        2 |     1
 40 | 200 |        3 |     1
 40 | 200 |        4 |     1
 40 | 200 |        5 |     1
 40 | 200 |        0 |     1
 40 | 200 |        1 |     1
 40 | 200 |        2 |     1
 40 | 200 |        3 |     1
 40 | 200 |        0 |     1
 40 | 100 |        1 |     1
 40 | 100 |        0 |     1
 40 | 100 |        5 |     1
 40 | 100 |        1 |     1
 40 | 100 |        2 |     1
 40 | 100 |        3 |     1
 40 | 100 |        4 |     1
 40 | 100 |        5 |     1
 40 | 100 |        2 |     1
 40 | 100 |        3 |     1
 40 | 100 |        2 |     1
 40 | 100 |        1 |     1
 40 | 100 |        0 |     1
 40 | 100 |        0 |     1
 40 | 100 |        5 |     1
 40 | 100 |        4 |     1
 40 | 100 |        3 |     1
 40 | 100 |        2 |     1
 40 | 100 |        0 |     1
 40 | 100 |        1 |     1
 40 | 100 |        4 |     1
 40 | 100 |        1 |     1
 40 | 100 |        0 |     1
 40 | 100 |        1 |     1
 40 | 100 |        0 |     1
 40 | 100 |        0 |     1
 40 | 100 |        3 |     1
 40 | 100 |        0 |     1
 40 | 100 |        5 |     1
 40 | 100 |        4 |     1
 40 | 100 |        3 |     1
 40 | 100 |        2 |     1
 40 | 100 |        1 |     1
 40 | 100 |        0 |     1
 40 | 100 |        3 |     1
 40 | 100 |        2 |     1
 40 | 100 |        1 |     1
 40 | 100 |        0 |     1
 40 | 100 |        7 |     1
 40 | 100 |        6 |     1
 40 | 100 |        5 |     1
 40 | 100 |        4 |     1
 40 | 100 |        3 |     1
 40 | 100 |        2 |     1
 40 | 100 |        1 |     1
 40 | 100 |        0 |     1
 40 | 100 |        1 |     1
 40 | 100 |        0 |     1
 50 |     |        0 |     1
 50 |     |        0 |     2
 50 |     |        1 |     1
 50 |     |        0 |     1
 50 |     |        0 |     2
 50 |     |        1 |     1
 50 |     |        1 |     2
 50 |     |        0 |     1
 50 |     |        0 |     1
 50 |     |        1 |     1
 50 |     |        1 |     1
 50 |     |        0 |     1
 50 |     |        0 |     1
 50 |     |        0 |     1
 50 |     |        1 |     1
 50 |     |        0 |     1
 50 |     |        0 |     2
 50 |     |        1 |     2
 50 |     |        1 |     2
 50 |     |        1 |     1
 50 |     |        0 |     1
 50 |     |        1 |     1
 50 |     |        0 |     2
 50 |     |        0 |     1
 50 |     |        1 |     1
 50 | 400 |        7 |     1
 50 | 400 |        5 |     1
 50 | 400 |        4 |     1
 50 | 400 |        3 |     1
 50 | 400 |        2 |     1
 50 | 400 |        1 |     1
 50 | 400 |        0 |     1
 50 | 400 |        0 |     1
 50 | 400 |        1 |     1
 50 | 400 |        2 |     1
 50 | 400 |        3 |     1
 50 | 400 |        4 |     1
 50 | 400 |        5 |     1
 50 | 400 |        0 |     2
 50 | 400 |        1 |     2
 50 | 400 |        0 |     2
 50 | 400 |        1 |     2
 50 | 400 |        1 |     1
 50 | 400 |        0 |     1
 50 | 400 |        0 |     1
 50 | 400 |        2 |     2
 50 | 400 |        3 |     2
 50 | 400 |        5 |     2
 50 | 400 |        4 |     2
 50 | 400 |        3 |     2
 50 | 400 |        2 |     2
 50 | 400 |        1 |     2
 50 | 400 |        0 |     2
 50 | 400 |        0 |     1
 50 | 400 |        1 |     1
 50 | 400 |        2 |     1
 50 | 400 |        3 |     1
 50 | 400 |        2 |     1
 50 | 400 |        1 |     1
 50 | 400 |        0 |     1
 50 | 400 |        3 |     1
 50 | 400 |        4 |     1
 50 | 400 |        5 |     1
 50 | 400 |        6 |     1
 50 | 400 |        4 |     1
 50 | 400 |        5 |     1
 50 | 400 |        6 |     1
 50 | 400 |        7 |     1
 50 | 400 |        0 |     1
 50 | 400 |        1 |     1
 50 | 400 |        0 |     1
 50 | 400 |        2 |     1
 50 | 400 |        3 |     1
 50 | 400 |        5 |     2
 50 | 400 |        4 |     2
 50 | 400 |        3 |     2
 50 | 400 |        2 |     2
 50 | 400 |        1 |     2
 50 | 400 |        0 |     2
 50 | 400 |        0 |     2
 50 | 400 |        5 |     1
 50 | 400 |        4 |     1
 50 | 400 |        3 |     1
 50 | 400 |        2 |     1
 50 | 400 |        1 |     1
 50 | 400 |        5 |     1
 50 | 400 |        4 |     1
 50 | 400 |        2 |     1
 50 | 400 |        3 |     1
 50 | 400 |        0 |     1
 50 | 400 |        0 |     2
 50 | 400 |        1 |     2
 50 | 400 |        1 |     1
 50 | 400 |        0 |     1
 50 | 400 |        0 |     1
 50 | 400 |        1 |     1
 50 | 400 |        0 |     1
 50 | 400 |        1 |     1
 50 | 400 |        2 |     1
 50 | 400 |        3 |     1
    |     |        0 |     1
    |     |        0 |     1
    |     |        0 |     2
    |     |        0 |     1
    |     |        0 |     2
    |     |        0 |     1
    |     |        0 |     1
    |     |        0 |     1
    |     |        0 |     3
    |     |        0 |     4
    |     |        0 |     1
    |     |        0 |     1
    |     |        0 |     4
    |     |        0 |     1
    |     |        0 |     1
    |     |        0 |     8
    |     |        0 |     3
    |     |        0 |    12
    |     |        1 |    12
    |     |        2 |    12
    | 800 |        1 |     1
    | 800 |        2 |     1
    | 800 |        1 |     1
    | 800 |        0 |     1
    | 800 |        0 |     1
    | 800 |        1 |     1
    | 800 |        0 |     1
    | 800 |        1 |     1
    | 800 |        2 |     1
    | 800 |        0 |     1
    | 800 |        1 |     1
    | 800 |        0 |     1
    | 700 |        0 |     1
    | 700 |        1 |     1
    | 700 |        2 |     1
    | 700 |        1 |     1
    | 700 |        0 |     1
    | 700 |        1 |     1
    | 700 |        1 |     1
    | 700 |        0 |     1
    | 700 |        2 |     1
    | 700 |        1 |     1
    | 700 |        0 |     1
    | 700 |        0 |     1
    | 600 |        0 |     1
    | 600 |        2 |     1
    | 600 |        0 |     1
    | 600 |        0 |     1
    | 600 |        1 |     1
    | 600 |        1 |     1
    | 600 |        1 |     1
    | 600 |        2 |     1
    | 600 |        0 |     1
    | 600 |        1 |     1
    | 600 |        0 |     1
    | 600 |        1 |     1
    | 500 |        0 |     1
    | 500 |        1 |     1
    | 500 |        0 |     1
    | 500 |        1 |     1
    | 500 |        0 |     1
    | 500 |        1 |     1
    | 500 |        2 |     1
    | 500 |        0 |     1
    | 500 |        1 |     1
    | 500 |        2 |     1
    | 500 |        2 |     2
    | 500 |        1 |     2
    | 500 |        0 |     2
    | 500 |        1 |     1
    | 500 |        0 |     2
    | 500 |        1 |     2
    | 500 |        0 |     1
    | 500 |        1 |     1
    | 500 |        0 |     1
    | 400 |        1 |     1
    | 400 |        0 |     2
    | 400 |        2 |     1
    | 400 |        1 |     1
    | 400 |        0 |     1
    | 400 |        1 |     2
    | 400 |        0 |     1
    | 400 |        0 |     2
    | 400 |        0 |     1
    | 400 |        1 |     1
    | 400 |        2 |     2
    | 400 |        1 |     2
    | 400 |        2 |     1
    | 400 |        1 |     1
    | 400 |        0 |     1
    | 400 |        1 |     1
    | 400 |        0 |     1
    | 400 |        1 |     1
    | 400 |        0 |     1
    | 300 |        1 |     1
    | 300 |        0 |     1
    | 300 |        1 |     1
    | 300 |        0 |     1
    | 300 |        2 |     1
    | 300 |        1 |     1
    | 300 |        0 |     1
    | 300 |        1 |     1
    | 300 |        0 |     1
    | 300 |        1 |     1
    | 300 |        0 |     1
    | 300 |        2 |     1
    | 200 |        1 |     1
    | 200 |        1 |     1
    | 200 |        0 |     1
    | 200 |        0 |     1
    | 200 |        1 |     1
    | 200 |        0 |     1
    | 200 |        0 |     1
    | 200 |        1 |     1
    | 200 |        2 |     2
    | 200 |        0 |     2
    | 200 |        1 |     2
    | 200 |        1 |     1
    | 200 |        2 |     1
    | 200 |        0 |     2
    | 200 |        1 |     2
    | 200 |        0 |     1
    | 200 |        1 |     1
    | 200 |        2 |     1
    | 200 |        0 |     1
    | 100 |        2 |     1
    | 100 |        1 |     1
    | 100 |        0 |     1
    | 100 |        1 |     1
    | 100 |        0 |     1
    | 100 |        0 |     2
    | 100 |        1 |     2
    | 100 |        2 |     1
    | 100 |        0 |     1
    | 100 |        1 |     1
    | 100 |        2 |     1
    | 100 |        1 |     1
    | 100 |        0 |     1
    | 100 |        0 |     1
    | 100 |        0 |     1
    | 100 |        0 |     1
    | 100 |        1 |     1
    | 100 |        0 |     1
    | 100 |        1 |     1
    | 100 |        2 |     1
    | 100 |        1 |     1
    | 100 |        1 |     1
(823 rows)

-- Empty sets
select * from sale group by ();
ERROR:  column "sale.cn" must appear in the GROUP BY clause or be used in an aggregate function
select * from sale group by grouping sets(());
ERROR:  column "sale.cn" must appear in the GROUP BY clause or be used in an aggregate function
select * from sale group by grouping sets((), ());
ERROR:  column "sale.cn" must appear in the GROUP BY clause or be used in an aggregate function
select count(*) from sale group by ();
 count 
-------
    12
(1 row)

select count(*) from sale group by grouping sets(());
 count 
-------
    12
(1 row)

select count(*) from sale group by grouping sets((), ());
 count 
-------
    12
    12
(2 rows)

-- MPP-2312
create view grp_v1 as select count(*) from sale group by ();
create view grp_v2 as select count(*) from sale group by grouping sets(());
create view grp_v3 as select count(*) from sale group by grouping sets((), ());
\d grp_v1;
    View "public.grp_v1"
 Column |  Type  | Modifiers 
--------+--------+-----------
 count  | bigint | 
View definition:
 SELECT count(*) AS count
   FROM sale
  GROUP BY ();

\d grp_v2;
    View "public.grp_v2"
 Column |  Type  | Modifiers 
--------+--------+-----------
 count  | bigint | 
View definition:
 SELECT count(*) AS count
   FROM sale
  GROUP BY GROUPING SETS (());

\d grp_v3;
    View "public.grp_v3"
 Column |  Type  | Modifiers 
--------+--------+-----------
 count  | bigint | 
View definition:
 SELECT count(*) AS count
   FROM sale
  GROUP BY GROUPING SETS ((), ());

drop view grp_v1;
drop view grp_v2;
drop view grp_v3;
select cn,group_id(), qty, sale.pn, prc, vn, to_char(coalesce(sum(distinct qty*prc), 0), '999999.9999')
from sale, product
where sale.pn=product.pn
group by grouping sets ((qty, sale.pn, prc, cn,vn), (qty,sale.pn,prc,vn,cn), (sale.qty, prc, cn)); --mvd 1,3,4,5,6->7
 cn | ?column? | qty  | pn  | prc  | vn |   to_char    
----+----------+------+-----+------+----+--------------
  1 |        1 |    1 | 100 |    0 | 20 |        .0000
  1 |        0 |    1 | 100 |    0 | 20 |        .0000
  1 |        1 |    1 | 200 |    0 | 10 |        .0000
  1 |        0 |    1 | 200 |    0 | 10 |        .0000
  1 |        1 |    1 | 300 |    0 | 30 |        .0000
  1 |        0 |    1 | 300 |    0 | 30 |        .0000
  1 |        1 |    1 | 400 |    0 | 50 |        .0000
  1 |        0 |    1 | 400 |    0 | 50 |        .0000
  2 |        1 |    1 | 400 |    0 | 50 |        .0000
  2 |        0 |    1 | 400 |    0 | 50 |        .0000
  3 |        1 |    1 | 200 |    0 | 40 |        .0000
  3 |        0 |    1 | 200 |    0 | 40 |        .0000
  4 |        1 |    1 | 700 |    1 | 40 |       1.0000
  4 |        0 |    1 | 700 |    1 | 40 |       1.0000
  4 |        1 |    1 | 800 |    1 | 40 |       1.0000
  4 |        0 |    1 | 800 |    1 | 40 |       1.0000
  1 |        1 |   12 | 500 |    5 | 30 |      60.0000
  1 |        0 |   12 | 500 |    5 | 30 |      60.0000
  3 |        1 |   12 | 500 |    5 | 30 |      60.0000
  3 |        0 |   12 | 500 |    5 | 30 |      60.0000
  3 |        1 |   12 | 600 |    5 | 30 |      60.0000
  3 |        0 |   12 | 600 |    5 | 30 |      60.0000
  2 |        1 | 1100 | 100 | 2400 | 40 |  ######.####
  2 |        0 | 1100 | 100 | 2400 | 40 |  ######.####
  1 |        0 |    1 |     |    0 |    |        .0000
  2 |        0 |    1 |     |    0 |    |        .0000
  3 |        0 |    1 |     |    0 |    |        .0000
  4 |        0 |    1 |     |    1 |    |       1.0000
  1 |        0 |   12 |     |    5 |    |      60.0000
  3 |        0 |   12 |     |    5 |    |      60.0000
  2 |        0 | 1100 |     | 2400 |    |  ######.####
(31 rows)

select sale.pn, count(distinct prc), count(distinct vn), grouping(sale.pn)
from sale, product where sale.pn = product.pn group by rollup(sale.pn); --mvd 1,2->3
 pn  | count | count | grouping 
-----+-------+-------+----------
 100 |     2 |     2 |        0
 200 |     1 |     2 |        0
 300 |     1 |     1 |        0
 400 |     1 |     1 |        0
 500 |     1 |     1 |        0
 600 |     1 |     1 |        0
 700 |     1 |     1 |        0
 800 |     1 |     1 |        0
     |     4 |     5 |        1
(9 rows)

select sale.pn, count(distinct prc), count(distinct vn), sum(prc) + grouping(sale.pn)
from sale, product where sale.pn = product.pn group by rollup(sale.pn); --mvd 1->3
 pn  | count | count | ?column? 
-----+-------+-------+----------
 100 |     2 |     2 |     2400
 200 |     1 |     2 |        0
 300 |     1 |     1 |        0
 400 |     1 |     1 |        0
 500 |     1 |     1 |       10
 600 |     1 |     1 |        5
 700 |     1 |     1 |        1
 800 |     1 |     1 |        1
     |     4 |     5 |     2418
(9 rows)

select sale.pn, count(distinct prc), count(distinct vn), sum(prc) + log(sale.pn) + grouping(sale.pn)
from sale, product where sale.pn = product.pn group by rollup(sale.pn); --mvd 1->3
 pn  | count | count |     ?column?     
-----+-------+-------+------------------
 100 |     2 |     2 |             2402
 200 |     1 |     2 | 2.30102999566398
 300 |     1 |     1 | 2.47712125471966
 400 |     1 |     1 | 2.60205999132796
 500 |     1 |     1 |  12.698970004336
 600 |     1 |     1 | 7.77815125038364
 700 |     1 |     1 | 3.84509804001426
 800 |     1 |     1 | 3.90308998699194
     |     4 |     5 |                 
(9 rows)

SELECT group_id(), sale.pn, sale.qty, sale.cn, sale.prc, STDDEV(sale.prc*sale.cn),MIN(DISTINCT sale.prc*sale.vn) from sale
GROUP BY ROLLUP((sale.qty,sale.cn),(sale.qty,sale.pn),(sale.vn),(sale.prc)),ROLLUP((sale.dt,sale.pn,sale.qty)); --mvd 2,3,4,5->6
 ?column? | pn  | qty  | cn | prc  |      stddev      |  min  
----------+-----+------+----+------+------------------+-------
        0 | 100 |    1 |  1 |    0 |                  |     0
        0 | 200 |    1 |  1 |    0 |                  |     0
        0 | 200 |    1 |  3 |    0 |                  |     0
        0 | 300 |    1 |  1 |    0 |                  |     0
        0 | 400 |    1 |  1 |    0 |                  |     0
        0 | 400 |    1 |  2 |    0 |                  |     0
        0 | 700 |    1 |  4 |    1 |                  |    40
        0 | 800 |    1 |  4 |    1 |                  |    40
        0 | 500 |   12 |  1 |    5 |                  |   150
        0 | 500 |   12 |  3 |    5 |                  |   150
        0 | 600 |   12 |  3 |    5 |                  |   150
        0 | 100 | 1100 |  2 | 2400 |                  | 96000
        0 | 100 |    1 |  1 |      |                  |     0
        0 | 200 |    1 |  1 |      |                  |     0
        0 | 200 |    1 |  3 |      |                  |     0
        0 | 300 |    1 |  1 |      |                  |     0
        0 | 400 |    1 |  1 |      |                  |     0
        0 | 400 |    1 |  2 |      |                  |     0
        0 | 700 |    1 |  4 |      |                  |    40
        0 | 800 |    1 |  4 |      |                  |    40
        0 | 500 |   12 |  1 |      |                  |   150
        0 | 500 |   12 |  3 |      |                  |   150
        0 | 600 |   12 |  3 |      |                  |   150
        0 | 100 | 1100 |  2 |      |                  | 96000
        1 | 100 |    1 |  1 |      |                  |     0
        0 | 100 |    1 |  1 |      |                  |     0
        1 | 200 |    1 |  1 |      |                  |     0
        0 | 200 |    1 |  1 |      |                  |     0
        1 | 200 |    1 |  3 |      |                  |     0
        0 | 200 |    1 |  3 |      |                  |     0
        1 | 300 |    1 |  1 |      |                  |     0
        0 | 300 |    1 |  1 |      |                  |     0
        1 | 400 |    1 |  1 |      |                  |     0
        0 | 400 |    1 |  1 |      |                  |     0
        1 | 400 |    1 |  2 |      |                  |     0
        0 | 400 |    1 |  2 |      |                  |     0
        1 | 700 |    1 |  4 |      |                  |    40
        0 | 700 |    1 |  4 |      |                  |    40
        1 | 800 |    1 |  4 |      |                  |    40
        0 | 800 |    1 |  4 |      |                  |    40
        1 | 500 |   12 |  1 |      |                  |   150
        0 | 500 |   12 |  1 |      |                  |   150
        1 | 500 |   12 |  3 |      |                  |   150
        0 | 500 |   12 |  3 |      |                  |   150
        1 | 600 |   12 |  3 |      |                  |   150
        0 | 600 |   12 |  3 |      |                  |   150
        1 | 100 | 1100 |  2 |      |                  | 96000
        0 | 100 | 1100 |  2 |      |                  | 96000
        0 | 100 |    1 |    |      |                  |     0
        0 | 200 |    1 |    |      |                  |     0
        0 | 200 |    1 |    |      |                  |     0
        0 | 300 |    1 |    |      |                  |     0
        0 | 400 |    1 |    |      |                0 |     0
        0 | 700 |    1 |    |      |                  |    40
        0 | 800 |    1 |    |      |                  |    40
        0 | 500 |   12 |    |      | 7.07106781186548 |   150
        0 | 600 |   12 |    |      |                  |   150
        0 | 100 | 1100 |    |      |                  | 96000
        0 |     |      |    |      | 1384.52331529883 |     0
        0 | 100 |    1 |  1 |    0 |                  |     0
        0 | 200 |    1 |  1 |    0 |                  |     0
        0 | 300 |    1 |  1 |    0 |                  |     0
        0 | 400 |    1 |  1 |    0 |                  |     0
        0 | 400 |    1 |  2 |    0 |                  |     0
        0 | 200 |    1 |  3 |    0 |                  |     0
        0 | 700 |    1 |  4 |    1 |                  |    40
        0 | 800 |    1 |  4 |    1 |                  |    40
        0 | 500 |   12 |  1 |    5 |                  |   150
        0 | 500 |   12 |  3 |    5 |                  |   150
        0 | 600 |   12 |  3 |    5 |                  |   150
        0 | 100 | 1100 |  2 | 2400 |                  | 96000
        0 | 100 |    1 |  1 |      |                  |     0
        0 | 200 |    1 |  1 |      |                  |     0
        0 | 300 |    1 |  1 |      |                  |     0
        0 | 400 |    1 |  1 |      |                  |     0
        0 | 400 |    1 |  2 |      |                  |     0
        0 | 200 |    1 |  3 |      |                  |     0
        0 | 700 |    1 |  4 |      |                  |    40
        0 | 800 |    1 |  4 |      |                  |    40
        0 | 500 |   12 |  1 |      |                  |   150
        0 | 500 |   12 |  3 |      |                  |   150
        0 | 600 |   12 |  3 |      |                  |   150
        0 | 100 | 1100 |  2 |      |                  | 96000
        0 | 100 |    1 |  1 |      |                  |     0
        0 | 200 |    1 |  1 |      |                  |     0
        0 | 300 |    1 |  1 |      |                  |     0
        0 | 400 |    1 |  1 |      |                  |     0
        0 | 400 |    1 |  2 |      |                  |     0
        0 | 200 |    1 |  3 |      |                  |     0
        0 | 700 |    1 |  4 |      |                  |    40
        0 | 800 |    1 |  4 |      |                  |    40
        0 | 500 |   12 |  1 |      |                  |   150
        0 | 500 |   12 |  3 |      |                  |   150
        0 | 600 |   12 |  3 |      |                  |   150
        0 | 100 | 1100 |  2 |      |                  | 96000
        0 |     |    1 |  1 |      |                0 |     0
        0 |     |    1 |  2 |      |                  |     0
        0 |     |    1 |  3 |      |                  |     0
        0 |     |    1 |  4 |      |                0 |    40
        0 |     |   12 |  1 |      |                  |   150
        0 |     |   12 |  3 |      |                0 |   150
        0 |     | 1100 |  2 |      |                  | 96000
(102 rows)

-- MPP-6756
drop table r6756 cascade; --ignore
ERROR:  table "r6756" does not exist
drop table s6756 cascade; --ignore
ERROR:  table "s6756" does not exist
create table r6756 ( a int, b int, x int, y int ) 
    distributed randomly
    partition by list(a) (
        values (0), 
        values (1)
        );
NOTICE:  CREATE TABLE will create partition "r6756_1_prt_1" for table "r6756"
NOTICE:  CREATE TABLE will create partition "r6756_1_prt_2" for table "r6756"
create table s6756 ( c int, d int, e int ) 
    distributed randomly;
insert into s6756 values 
    (0,0,0),(0,0,1),(0,1,0),(0,1,1),(1,0,0),(1,0,1),(1,1,0),(1,1,1);
insert into r6756 values
    (0, 0, 1, 1),
    (0, 1, 2, 2),
    (0, 1, 2, 2),
    (1, 0, 3, 3),
    (1, 0, 3, 3),
    (1, 0, 3, 3),
    (1, 1, 4, 4),
    (1, 1, 4, 4),
    (1, 1, 4, 4),
    (1, 1, 4, 4);
--start_equiv
select a, b, count(distinct x), count(distinct y)
from r6756 r, s6756 c, s6756 d, s6756 e
where r.a = c.c and r.a = d.d and r.a = e.e
group by a, b
union all
select a, null, count(distinct x), count(distinct y)
from r6756 r, s6756 c, s6756 d, s6756 e
where r.a = c.c and r.a = d.d and r.a = e.e
group by a
union all
select null, null, count(distinct x), count(distinct y)
from r6756 r, s6756 c, s6756 d, s6756 e
where r.a = c.c and r.a = d.d and r.a = e.e;
 a | b | count | count 
---+---+-------+-------
 0 | 1 |     1 |     1
 1 | 0 |     1 |     1
 1 |   |     2 |     2
 0 | 0 |     1 |     1
 1 | 1 |     1 |     1
 0 |   |     2 |     2
   |   |     4 |     4
(7 rows)

select a, b, count(distinct x), count(distinct y)
from r6756 r, s6756 c, s6756 d, s6756 e
where r.a = c.c and r.a = d.d and r.a = e.e
group by rollup (a,b);
 a | b | count | count 
---+---+-------+-------
 0 | 0 |     1 |     1
 0 | 1 |     1 |     1
 1 | 0 |     1 |     1
 1 | 1 |     1 |     1
 0 |   |     2 |     2
 1 |   |     2 |     2
   |   |     4 |     4
(7 rows)

--end_equiv
--start_equiv
select a, b, array_agg((a+1)*x order by x), array_agg((b+1)*y order by y)
from r6756 r
group by a, b
union all
select a, null, array_agg((a+1)*x order by x), array_agg((b+1)*y order by y)
from r6756 r
group by a
union all
select null, null, array_agg((a+1)*x order by x), array_agg((b+1)*y order by y)
from r6756 r
;
 a | b |       array_agg       |       array_agg       
---+---+-----------------------+-----------------------
 0 | 0 | {1}                   | {1}
 0 | 1 | {2,2}                 | {4,4}
 0 |   | {1,2,2}               | {1,4,4}
 1 | 0 | {6,6,6}               | {3,3,3}
 1 | 1 | {8,8,8,8}             | {8,8,8,8}
 1 |   | {6,6,6,8,8,8,8}       | {3,3,3,8,8,8,8}
   |   | {1,2,2,6,6,6,8,8,8,8} | {1,4,4,3,3,3,8,8,8,8}
(7 rows)

select a, b, array_agg((a+1)*x order by x), array_agg((b+1)*y order by y)
from r6756 r
group by rollup (a,b);
 a | b |       array_agg       |       array_agg       
---+---+-----------------------+-----------------------
 0 | 0 | {1}                   | {1}
 0 | 1 | {2,2}                 | {4,4}
 0 |   | {1,2,2}               | {1,4,4}
 1 | 0 | {6,6,6}               | {3,3,3}
 1 | 1 | {8,8,8,8}             | {8,8,8,8}
 1 |   | {6,6,6,8,8,8,8}       | {3,3,3,8,8,8,8}
   |   | {1,2,2,6,6,6,8,8,8,8} | {1,4,4,3,3,3,8,8,8,8}
(7 rows)

--end_equiv
drop table r6756 cascade; --ignore
drop table s6756 cascade; --ignore
-- begin MPP-14021
select sum((select prc from sale where cn = s.cn and vn = s.vn and pn = s.pn)) from sale s;
 sum  
------
 2417
(1 row)

-- end MPP-14021
-- begin MPP-14125: if prelim function is missing, do not choose hash agg.
create temp table mpp14125 as select repeat('a', a) a, a % 10 b from generate_series(1, 100)a;
explain select string_agg(a) from mpp14125 group by b;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice2; segments: 2)  (cost=8.32..9.20 rows=5 width=36)
   ->  GroupAggregate  (cost=8.32..9.20 rows=5 width=36)
         Group By: b
         ->  Sort  (cost=8.32..8.57 rows=50 width=55)
               Sort Key: b
               ->  Redistribute Motion 2:2  (slice1; segments: 2)  (cost=0.00..5.00 rows=50 width=55)
                     Hash Key: b
                     ->  Seq Scan on mpp14125  (cost=0.00..3.00 rows=50 width=55)
(8 rows)

-- end MPP-14125
